/*
 * noVNC: HTML5 VNC client
 * Copyright (C) 2012 Joel Martin
 * Licensed under MPL 2.0 (see LICENSE.txt)
 *
 * See README.md for usage and integration instructions.
 */
function Display(e){"use strict";function t(){Util.Debug(">> Display.constructor");var e,t,n,r,i=Util.Engine;if(!u.target)throw"target must be set";if("string"==typeof u.target)throw"target must be a DOM element";if(e=u.target,!e.getContext)throw"no getContext method";if(c||(c=e.getContext("2d")),Util.Debug("User Agent: "+navigator.userAgent),i.gecko&&Util.Debug("Browser: gecko "+i.gecko),i.webkit&&Util.Debug("Browser: webkit "+i.webkit),i.trident&&Util.Debug("Browser: trident "+i.trident),i.presto&&Util.Debug("Browser: presto "+i.presto),l.clear(),!("createImageData"in c))throw"Canvas does not support createImageData";for(u.render_mode="canvas rendering",null===u.prefer_js&&(Util.Info("Prefering javascript operations"),u.prefer_js=!0),v=c.createImageData(16,16),n=[],t=0;256>t;t+=1)n.push(255);try{r=e.style.cursor,changeCursor(u.target,n,n,2,2,8,8),e.style.cursor?(null===u.cursor_uri&&(u.cursor_uri=!0),Util.Info("Data URI scheme cursor supported")):(null===u.cursor_uri&&(u.cursor_uri=!1),Util.Warn("Data URI scheme cursor not supported")),e.style.cursor=r}catch(o){Util.Error("Data URI scheme cursor test exception: "+o),u.cursor_uri=!1}return Util.Debug("<< Display.constructor"),l}var n,r,i,o,s,a,l={},u={},c=null,d=[],f=0,h=0,p={x:0,y:0,w:0,h:0},g={x1:0,y1:0,x2:-1,y2:-1},y="",m=null,v=null,b=0,w=0;return Util.conf_defaults(u,l,e,[["target","wo","dom",null,"Canvas element for rendering"],["context","ro","raw",null,"Canvas 2D context for rendering (read-only)"],["logo","rw","raw",null,'Logo to display when cleared: {"width": width, "height": height, "data": data}'],["true_color","rw","bool",!0,"Use true-color pixel data"],["colourMap","rw","arr",[],"Colour map array (when not true-color)"],["scale","rw","float",1,"Display area scale factor 0.0 - 1.0"],["viewport","rw","bool",!1,"Use a viewport set with viewportChange()"],["width","rw","int",null,"Display area width"],["height","rw","int",null,"Display area height"],["render_mode","ro","str","","Canvas rendering mode (read-only)"],["prefer_js","rw","str",null,"Prefer Javascript over canvas methods"],["cursor_uri","rw","raw",null,"Can we render cursor using data URI"]]),l.get_context=function(){return c},l.set_scale=function(e){s(e)},l.set_width=function(e){l.resize(e,h)},l.get_width=function(){return f},l.set_height=function(e){l.resize(f,e)},l.get_height=function(){return h},s=function(e){var t,n,r,i,o=["transform","WebkitTransform","MozTransform",null];for(t=u.target,n=o.shift();n&&"undefined"==typeof t.style[n];)n=o.shift();return null===n?void Util.Debug("No scaling support"):("undefined"==typeof e?e=u.scale:e>1?e=1:.1>e&&(e=.1),void(u.scale!==e&&(u.scale=e,r=t.width-t.width*e,i=t.height-t.height*e,t.style[n]="scale("+u.scale+") translate(-"+r+"px, -"+i+"px)")))},o=function(e){var t,n;t=u.true_color?e:u.colourMap[e[0]],n="rgb("+t[2]+","+t[1]+","+t[0]+")",n!==y&&(c.fillStyle=n,y=n)},l.viewportChange=function(e,t,n,r){var i,o,s,a,l,d,y,m=u.target,v=p,b=g,w=null;u.viewport||(Util.Debug("Setting viewport to full display region"),e=-v.w,t=-v.h,n=f,r=h),"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=v.w),"undefined"==typeof r&&(r=v.h),n>f&&(n=f),r>h&&(r=h),(v.w!==n||v.h!==r)&&(n<v.w&&b.x2>v.x+n-1&&(b.x2=v.x+n-1),v.w=n,r<v.h&&b.y2>v.y+r-1&&(b.y2=v.y+r-1),v.h=r,v.w>0&&v.h>0&&m.width>0&&m.height>0&&(w=c.getImageData(0,0,m.width<v.w?m.width:v.w,m.height<v.h?m.height:v.h)),m.width=v.w,m.height=v.h,w&&c.putImageData(w,0,0)),a=v.x+v.w-1,l=v.y+v.h-1,0>e&&v.x+e<0&&(e=-v.x),a+e>=f&&(e-=a+e-f+1),v.y+t<0&&(t=-v.y),l+t>=h&&(t-=l+t-h+1),(0!==e||0!==t)&&(Util.Debug("viewportChange deltaX: "+e+", deltaY: "+t),v.x+=e,a+=e,v.y+=t,l+=t,v.x>b.x1&&(b.x1=v.x),a<b.x2&&(b.x2=a),v.y>b.y1&&(b.y1=v.y),l<b.y2&&(b.y2=l),0>e?(o=0,d=-e):(o=v.w-e,d=e),0>t?(s=0,y=-t):(s=v.h-t,y=t),i=c.fillStyle,c.fillStyle="rgb(255,255,255)",0!==e&&(c.drawImage(m,0,0,v.w,v.h,-e,0,v.w,v.h),c.fillRect(o,0,d,v.h)),0!==t&&(c.drawImage(m,0,0,v.w,v.h,0,-t,v.w,v.h),c.fillRect(0,s,v.w,y)),c.fillStyle=i)},l.getCleanDirtyReset=function(){var e,t=p,n=g,r=[],i=t.x+t.w-1,o=t.y+t.h-1;return e={x:n.x1,y:n.y1,w:n.x2-n.x1+1,h:n.y2-n.y1+1},n.x1>=n.x2||n.y1>=n.y2?r.push({x:t.x,y:t.y,w:t.w,h:t.h}):(t.x<n.x1&&r.push({x:t.x,y:t.y,w:n.x1-t.x+1,h:t.h}),i>n.x2&&r.push({x:n.x2+1,y:t.y,w:i-n.x2,h:t.h}),t.y<n.y1&&r.push({x:n.x1,y:t.y,w:n.x2-n.x1+1,h:n.y1-t.y}),o>n.y2&&r.push({x:n.x1,y:n.y2+1,w:n.x2-n.x1+1,h:o-n.y2})),g={x1:t.x,y1:t.y,x2:t.x+t.w-1,y2:t.y+t.h-1},{cleanBox:e,dirtyBoxes:r}},l.absX=function(e){return e+p.x},l.absY=function(e){return e+p.y},l.resize=function(e,t){y="",f=e,h=t,s(u.scale),l.viewportChange()},l.clear=function(){u.logo?(l.resize(u.logo.width,u.logo.height),l.blitStringImage(u.logo.data,0,0)):(l.resize(640,20),c.clearRect(0,0,p.w,p.h)),d=[]},l.fillRect=function(e,t,n,r,i){o(i),c.fillRect(e-p.x,t-p.y,n,r)},l.copyImage=function(e,t,n,r,i,o){var s=e-p.x,a=t-p.y,l=n-p.x,d=r-p.y;c.drawImage(u.target,s,a,i,o,l,d,i,o)},l.startTile=function(e,t,n,r,i){var o,s,a,d,f,h;if(b=e,w=t,m=16===n&&16===r?v:c.createImageData(n,r),o=m.data,u.prefer_js)for(s=u.true_color?i:u.colourMap[i[0]],a=s[2],d=s[1],f=s[0],h=0;n*r*4>h;h+=4)o[h]=a,o[h+1]=d,o[h+2]=f,o[h+3]=255;else l.fillRect(e,t,n,r,i)},l.subTile=function(e,t,n,r,i){var o,s,a,c,d,f,h,p,g,y,v;if(u.prefer_js)for(o=m.data,h=m.width,a=u.true_color?i:u.colourMap[i[0]],c=a[2],d=a[1],f=a[0],y=e+n,v=t+r,p=t;v>p;p+=1)for(g=e;y>g;g+=1)s=4*(g+p*h),o[s]=c,o[s+1]=d,o[s+2]=f,o[s+3]=255;else l.fillRect(b+e,w+t,n,r,i)},l.finishTile=function(){u.prefer_js&&c.putImageData(m,b-p.x,w-p.y)},n=function(e,t,n,r,i,o,s,a){var l,u,d,f;for(l=c.createImageData(i,o),f=l.data,u=0,d=a;i*o*4>u;u+=4,d+=3)f[u]=s[d],f[u+1]=s[d+1],f[u+2]=s[d+2],f[u+3]=255;c.putImageData(l,e-n,t-r)},r=function(e,t,n,r,i,o,s,a){var l,u,d,f;for(l=c.createImageData(i,o),f=l.data,u=0,d=a;i*o*4>u;u+=4,d+=4)f[u]=s[d+2],f[u+1]=s[d+1],f[u+2]=s[d],f[u+3]=255;c.putImageData(l,e-n,t-r)},i=function(e,t,n,r,i,o,s,a){var l,d,f,h,p,g;for(l=c.createImageData(i,o),h=l.data,g=u.colourMap,d=0,f=a;i*o*4>d;d+=4,f+=1)p=g[s[f]],h[d]=p[2],h[d+1]=p[1],h[d+2]=p[0],h[d+3]=255;c.putImageData(l,e-n,t-r)},l.blitImage=function(e,t,n,o,s,a){u.true_color?r(e,t,p.x,p.y,n,o,s,a):i(e,t,p.x,p.y,n,o,s,a)},l.blitRgbImage=function(e,t,r,o,s,a){u.true_color?n(e,t,p.x,p.y,r,o,s,a):i(e,t,p.x,p.y,r,o,s,a)},l.blitStringImage=function(e,t,n){var r=new Image;r.onload=function(){c.drawImage(r,t-p.x,n-p.y)},r.src=e},l.drawImage=function(e,t,n){c.drawImage(e,t-p.x,n-p.y)},l.renderQ_push=function(e){d.push(e),1===d.length&&a()},a=function(){for(var e,t=!0;t&&d.length>0;){switch(e=d[0],e.type){case"copy":l.copyImage(e.old_x,e.old_y,e.x,e.y,e.width,e.height);break;case"fill":l.fillRect(e.x,e.y,e.width,e.height,e.color);break;case"blit":l.blitImage(e.x,e.y,e.width,e.height,e.data,0);break;case"blitRgb":l.blitRgbImage(e.x,e.y,e.width,e.height,e.data,0);break;case"img":e.img.complete?l.drawImage(e.img,e.x,e.y):t=!1}t&&(e=d.shift())}d.length>0&&requestAnimFrame(a)},l.changeCursor=function(e,t,n,r,i,o){return u.cursor_uri===!1?void Util.Warn("changeCursor called but no cursor data URI support"):void(u.true_color?changeCursor(u.target,e,t,n,r,i,o):changeCursor(u.target,e,t,n,r,i,o,u.colourMap))},l.defaultCursor=function(){u.target.style.cursor="default"},t()}function changeCursor(e,t,n,r,i,o,s,a){"use strict";var l,u,c,d,f,h,p,g,y,m,v=[],b=o,w=s;for(b>w?w=b:b=w,v.push16le=function(e){this.push(255&e,e>>8&255)},v.push32le=function(e){this.push(255&e,e>>8&255,e>>16&255,e>>24&255)},u=40,c=b*w*4,f=Math.ceil(b*w/8),d=Math.ceil(b*w/8),v.push16le(0),v.push16le(2),v.push16le(1),v.push(b),v.push(w),v.push(0),v.push(0),v.push16le(r),v.push16le(i),v.push32le(u+c+f+d),v.push32le(22),v.push32le(u),v.push32le(b),v.push32le(2*w),v.push16le(1),v.push16le(32),v.push32le(0),v.push32le(f+d),v.push32le(0),v.push32le(0),v.push32le(0),v.push32le(0),m=w-1;m>=0;m-=1)for(y=0;b>y;y+=1)y>=o||m>=s?(v.push(0),v.push(0),v.push(0),v.push(0)):(p=m*Math.ceil(o/8)+Math.floor(y/8),g=n[p]<<y%8&128?255:0,a?(p=o*m+y,l=a[t[p]],v.push(l[2]),v.push(l[1]),v.push(l[0]),v.push(g)):(p=4*(o*m+y),v.push(t[p+2]),v.push(t[p+1]),v.push(t[p]),v.push(g)));for(m=0;w>m;m+=1)for(y=0;y<Math.ceil(b/8);y+=1)v.push(0);for(m=0;w>m;m+=1)for(y=0;y<Math.ceil(b/8);y+=1)v.push(0);h="data:image/x-icon;base64,"+Base64.encode(v),e.style.cursor="url("+h+") "+r+" "+i+", default"}/*
 * noVNC: HTML5 VNC client
 * Copyright (C) 2012 Joel Martin
 * Copyright (C) 2013 Samuel Mannehed for Cendio AB
 * Licensed under MPL 2.0 or any later version (see LICENSE.txt)
 */
function Keyboard(e){"use strict";function t(e){a.onKeyPress&&(Util.Debug("onKeyPress "+("keydown"==e.type?"down":"up")+", keysym: "+e.keysym.keysym+"("+e.keysym.keyname+")"),a.onKeyPress(e.keysym.keysym,"keydown"==e.type))}function n(e){return a.focused&&l.keydown(e)?(Util.stopEvent(e),!1):!0}function r(e){return a.focused&&l.keypress(e)?(Util.stopEvent(e),!1):!0}function i(e){return a.focused&&l.keyup(e)?(Util.stopEvent(e),!1):!0}function o(){Util.Debug(">> Keyboard.allKeysUp"),l.releaseAll(),Util.Debug("<< Keyboard.allKeysUp")}var s={},a={};Util.conf_defaults(a,s,e,[["target","wo","dom",document,"DOM element that captures keyboard input"],["focused","rw","bool",!0,"Capture and send key events"],["onKeyPress","rw","func",null,"Handler for key press/release"]]);var l=KeyEventDecoder(kbdUtil.ModifierSync(),VerifyCharModifier(TrackKeyState(EscapeModifiers(t))));return s.grab=function(){var e=a.target;Util.addEvent(e,"keydown",n),Util.addEvent(e,"keyup",i),Util.addEvent(e,"keypress",r),Util.addEvent(window,"blur",o)},s.ungrab=function(){var e=a.target;Util.removeEvent(e,"keydown",n),Util.removeEvent(e,"keyup",i),Util.removeEvent(e,"keypress",r),Util.removeEvent(window,"blur",o),o()},s.sync=function(e){l.syncModifiers(e)},s}function Mouse(e){"use strict";function t(){d.target.setCapture&&d.target.setCapture(),f=!0}function n(){d.target.releaseCapture&&d.target.releaseCapture(),f=!1}function r(){h=null}function i(e,t){var n,i,o;if(!d.focused)return!0;if(d.notify&&d.notify(e),n=e?e:window.event,i=Util.getEventPosition(e,d.target,d.scale),e.touches||e.changedTouches){if(1==t){if(null==h)p=i;else{clearTimeout(h);var s=p.x-i.x,a=p.y-i.y,l=Math.sqrt(s*s+a*a);l<20*window.devicePixelRatio&&(i=p)}h=setTimeout(r,500)}o=d.touchButton}else o=n.which?1<<n.button:(1&n.button)+2*(2&n.button)+(4&n.button)/2;return d.onMouseButton&&(Util.Debug("onMouseButton "+(t?"down":"up")+", x: "+i.x+", y: "+i.y+", bmask: "+o),d.onMouseButton(i.x,i.y,t,o)),Util.stopEvent(e),!1}function o(e){t(),i(e,1)}function s(e){f&&(i(e,0),n())}function a(e){var t,n,r,i;return d.focused?(d.notify&&d.notify(e),t=e?e:window.event,n=Util.getEventPosition(e,d.target,d.scale),i=t.detail?-1*t.detail:t.wheelDelta/40,r=i>0?8:16,d.onMouseButton&&(d.onMouseButton(n.x,n.y,1,r),d.onMouseButton(n.x,n.y,0,r)),Util.stopEvent(e),!1):!0}function l(e){var t,n;return d.focused?(d.notify&&d.notify(e),t=e?e:window.event,n=Util.getEventPosition(e,d.target,d.scale),d.onMouseMove&&d.onMouseMove(n.x,n.y),Util.stopEvent(e),!1):!0}function u(e){var t,n;return d.focused?(t=e?e:window.event,n=Util.getEventPosition(e,d.target,d.scale),n.realx>=0&&n.realy>=0&&n.realx<d.target.offsetWidth&&n.realy<d.target.offsetHeight?(Util.stopEvent(e),!1):!0):!0}var c={},d={},f=!1,h=null,p=null;return Util.conf_defaults(d,c,e,[["target","ro","dom",document,"DOM element that captures mouse input"],["notify","ro","func",null,"Function to call to notify whenever a mouse event is received"],["focused","rw","bool",!0,"Capture and send mouse clicks/movement"],["scale","rw","float",1,"Viewport scale factor 0.0 - 1.0"],["onMouseButton","rw","func",null,"Handler for mouse button click/release"],["onMouseMove","rw","func",null,"Handler for mouse movement"],["touchButton","rw","int",1,"Button mask (1, 2, 4) for touch devices (0 means ignore clicks)"]]),c.grab=function(){var e=d.target;"ontouchstart"in document.documentElement?(Util.addEvent(e,"touchstart",o),Util.addEvent(window,"touchend",s),Util.addEvent(e,"touchend",s),Util.addEvent(e,"touchmove",l)):(Util.addEvent(e,"mousedown",o),Util.addEvent(window,"mouseup",s),Util.addEvent(e,"mouseup",s),Util.addEvent(e,"mousemove",l),Util.addEvent(e,Util.Engine.gecko?"DOMMouseScroll":"mousewheel",a)),Util.addEvent(document,"click",u),Util.addEvent(document.body,"contextmenu",u)},c.ungrab=function(){var e=d.target;"ontouchstart"in document.documentElement?(Util.removeEvent(e,"touchstart",o),Util.removeEvent(window,"touchend",s),Util.removeEvent(e,"touchend",s),Util.removeEvent(e,"touchmove",l)):(Util.removeEvent(e,"mousedown",o),Util.removeEvent(window,"mouseup",s),Util.removeEvent(e,"mouseup",s),Util.removeEvent(e,"mousemove",l),Util.removeEvent(e,Util.Engine.gecko?"DOMMouseScroll":"mousewheel",a)),Util.removeEvent(document,"click",u),Util.removeEvent(document.body,"contextmenu",u)},c}function JSUnzip(){this.getInt=function(e,t){switch(t){case 4:return(255&this.data.charCodeAt(e+3))<<24|(255&this.data.charCodeAt(e+2))<<16|(255&this.data.charCodeAt(e+1))<<8|255&this.data.charCodeAt(e+0);case 2:return(255&this.data.charCodeAt(e+1))<<8|255&this.data.charCodeAt(e+0);default:return 255&this.data.charCodeAt(e)}},this.getDOSDate=function(e,t){var n=31&e,r=(e>>5&15)-1,i=1980+(e>>9&127),o=2*(31&t),s=t>>5&63;return hour=t>>11&31,new Date(i,r,n,hour,s,o)},this.open=function(e){if(this.data=e,this.files=[],this.data.length<22)return{status:!1,error:"Invalid data"};for(var t=this.data.length-22;t>=0&&101010256!=this.getInt(t,4);)--t;if(0>t)return{status:!1,error:"Invalid data"};if(0!=this.getInt(t+4,2)||0!=this.getInt(t+6,2))return{status:!1,error:"No multidisk support"};var n=this.getInt(t+8,2),r=this.getInt(t+16,4),i=this.getInt(t+20,2);this.comment=this.data.slice(t+22,t+22+i);for(var o=r,s=0;n>s;++s){if(33639248!=this.getInt(o+0,4))return{status:!1,error:"Invalid data"};if(this.getInt(o+6,2)>20)return{status:!1,error:"Unsupported version"};if(1&this.getInt(o+8,2))return{status:!1,error:"Encryption not implemented"};var a=this.getInt(o+10,2);if(0!=a&&8!=a)return{status:!1,error:"Unsupported compression method"};var l=this.getInt(o+12,2),u=this.getInt(o+14,2),c=this.getDOSDate(u,l),d=(this.getInt(o+16,4),this.getInt(o+20,4)),f=this.getInt(o+24,4),h=this.getInt(o+28,2),p=this.getInt(o+30,2),g=this.getInt(o+32,2),y=this.getInt(o+42,4),m=this.data.slice(o+46,o+46+h),v=this.data.slice(o+46+h+p,o+46+h+p+g);if(67324752!=this.getInt(y+0,4))return{status:!1,error:"Invalid data"};var b=this.getInt(y+26,2),w=this.getInt(y+28,2),x=y+30+b+w;this.files[m]={fileComment:v,compressionMethod:a,compressedSize:d,uncompressedSize:f,localFileContent:x,lastModifiedDate:c},o+=46+h+p+g}return{status:!0}},this.read=function(e){var t=this.files[e];if(t){if(8==t.compressionMethod){tinf||(tinf=new TINF,tinf.init());var n=tinf.uncompress(this.data,t.localFileContent);return n.status==tinf.OK?{status:!0,data:n.data}:{status:!1,error:n.error}}return{status:!0,data:this.data.slice(t.localFileContent,t.localFileContent+t.uncompressedSize)}}return{status:!1,error:"File '"+e+"' doesn't exist in zip"}}}function TINF(){function e(e,t,n,r,i){for(var o=0;24>t;)n|=(255&e[r++])<<t,t+=8;return o=n&65535>>16-i,n>>=i,t-=i,[t,n,r,o]}this.OK=0,this.DATA_ERROR=-3,this.WINDOW_SIZE=32768,this.TREE=function(){this.table=new Array(16),this.trans=new Array(288)},this.DATA=function(e){this.source="",this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=[],this.history=[],this.ltree=new e.TREE,this.dtree=new e.TREE},this.sltree=new this.TREE,this.sdtree=new this.TREE,this.length_bits=new Array(30),this.length_base=new Array(30),this.dist_bits=new Array(30),this.dist_base=new Array(30),this.clcidx=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],this.build_bits_base=function(e,t,n,r){var i,o;for(i=0;n>i;++i)e[i]=0;for(i=0;30-n>i;++i)e[i+n]=Math.floor(i/n);for(o=r,i=0;30>i;++i)t[i]=o,o+=1<<e[i]},this.build_fixed_trees=function(e,t){var n;for(n=0;7>n;++n)e.table[n]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,n=0;24>n;++n)e.trans[n]=256+n;for(n=0;144>n;++n)e.trans[24+n]=n;for(n=0;8>n;++n)e.trans[168+n]=280+n;for(n=0;112>n;++n)e.trans[176+n]=144+n;for(n=0;5>n;++n)t.table[n]=0;for(t.table[5]=32,n=0;32>n;++n)t.trans[n]=n},this.build_tree=function(e,t,n,r){var i,o,s=new Array(16);for(i=0;16>i;++i)e.table[i]=0;for(i=0;r>i;++i)e.table[t[n+i]]++;for(e.table[0]=0,o=0,i=0;16>i;++i)s[i]=o,o+=e.table[i];for(i=0;r>i;++i)t[n+i]&&(e.trans[s[t[n+i]]++]=i)},this.getbit=function(e){var t;return e.bitcount--||(e.tag=255&e.source[e.sourceIndex++],e.bitcount=7),t=1&e.tag,e.tag>>=1,t},this.read_bits=function(t,n,r){if(!n)return r;var i=e(t.source,t.bitcount,t.tag,t.sourceIndex,n);return t.bitcount=i[0],t.tag=i[1],t.sourceIndex=i[2],i[3]+r},this.decode_symbol=function(e,t){for(;e.bitcount<16;)e.tag=e.tag|(255&e.source[e.sourceIndex++])<<e.bitcount,e.bitcount+=8;var n=0,r=0,i=0;do r=2*r+((e.tag&1<<i)>>i),++i,n+=t.table[i],r-=t.table[i];while(r>=0);return e.tag>>=i,e.bitcount-=i,t.trans[n+r]},this.decode_trees=function(e,t,n){var r,i,o,s,a,l,u=new this.TREE,c=new Array(320);for(r=this.read_bits(e,5,257),i=this.read_bits(e,5,1),o=this.read_bits(e,4,4),s=0;19>s;++s)c[s]=0;for(s=0;o>s;++s){var d=this.read_bits(e,3,0);c[this.clcidx[s]]=d}for(this.build_tree(u,c,0,19),a=0;r+i>a;){var f=this.decode_symbol(e,u);switch(f){case 16:var h=c[a-1];for(l=this.read_bits(e,2,3);l;--l)c[a++]=h;break;case 17:for(l=this.read_bits(e,3,3);l;--l)c[a++]=0;break;case 18:for(l=this.read_bits(e,7,11);l;--l)c[a++]=0;break;default:c[a++]=f}}this.build_tree(t,c,0,r),this.build_tree(n,c,r,i)},this.inflate_block_data=function(e,t,n){for(var r=e.dest,i=r.length;;){var o=this.decode_symbol(e,t);if(256==o)return this.OK;if(256>o)r[i++]=o,e.history.push(o);else{var s,a,l,u;if(o-=257,s=this.read_bits(e,this.length_bits[o],this.length_base[o]),a=this.decode_symbol(e,n),l=e.history.length-this.read_bits(e,this.dist_bits[a],this.dist_base[a]),0>l)throw"Invalid zlib offset "+l;for(u=l;l+s>u;++u)r[i++]=e.history[u],e.history.push(e.history[u])}}},this.inflate_uncompressed_block=function(e){var t,n,r;if(e.bitcount>7){var i=Math.floor(e.bitcount/8);e.sourceIndex-=i,e.bitcount=0,e.tag=0}if(t=e.source[e.sourceIndex+1],t=256*t+e.source[e.sourceIndex],n=e.source[e.sourceIndex+3],n=256*n+e.source[e.sourceIndex+2],t!=(65535&~n))return this.DATA_ERROR;for(e.sourceIndex+=4,r=t;r;--r)e.history.push(e.source[e.sourceIndex]),e.dest[e.dest.length]=e.source[e.sourceIndex++];return e.bitcount=0,this.OK},this.inflate_fixed_block=function(e){return this.inflate_block_data(e,this.sltree,this.sdtree)},this.inflate_dynamic_block=function(e){return this.decode_trees(e,e.ltree,e.dtree),this.inflate_block_data(e,e.ltree,e.dtree)},this.init=function(){this.build_fixed_trees(this.sltree,this.sdtree),this.build_bits_base(this.length_bits,this.length_base,4,3),this.build_bits_base(this.dist_bits,this.dist_base,2,1),this.length_bits[28]=0,this.length_base[28]=258,this.reset()},this.reset=function(){this.d=new this.DATA(this),delete this.header},this.uncompress=function(e,t){var n,r=this.d;r.source=e,r.sourceIndex=t,r.bitcount=0,r.dest=[],"undefined"==typeof this.header&&(this.header=this.read_bits(r,16,0));var i=0;do{var o,s;switch(n=this.getbit(r),o=this.read_bits(r,2,0)){case 0:s=this.inflate_uncompressed_block(r);break;case 1:s=this.inflate_fixed_block(r);break;case 2:s=this.inflate_dynamic_block(r);break;default:return{status:this.DATA_ERROR}}if(s!=this.OK)return{status:this.DATA_ERROR};i++}while(!n&&r.sourceIndex<r.source.length);return r.history=r.history.slice(-this.WINDOW_SIZE),{status:this.OK,data:r.dest}}}function KeyEventDecoder(e,t){"use strict";function n(e){for(var n=0;n<e.length;++n)t(e[n])}function r(n,r){var i={type:r},o=kbdUtil.getKey(n);o&&(i.keyId=o);var s=kbdUtil.getKeysym(n),a=e.hasShortcutModifier()||!!e.activeCharModifier();s&&("keydown"!==r||kbdUtil.nonCharacterKey(n)||a)&&(i.keysym=s);var l=16===n.keyCode||"Shift"===n.key,u=!l&&("keydown"!==r||e.hasShortcutModifier()||!!kbdUtil.nonCharacterKey(n)),c="keydown"===r&&e.activeCharModifier()&&!kbdUtil.nonCharacterKey(n),d=e.activeCharModifier();if(d&&s){for(var f=!1,h=0;h<d.length;++h)d[h]===s.keysym&&(f=!0);"keypress"!==r||f||(i.escape=e.activeCharModifier())}return c&&t({type:"stall"}),t(i),u}return{keydown:function(t){return n(e.keydown(t)),r(t,"keydown")},keypress:function(e){return r(e,"keypress")},keyup:function(t){return n(e.keyup(t)),r(t,"keyup")},syncModifiers:function(t){n(e.syncAny(t))},releaseAll:function(){t({type:"releaseall"})}}}function VerifyCharModifier(e){"use strict";function t(){if(!r)for(;0!==n.length;){var i=n[0];switch(n=n.splice(1),i.type){case"stall":return void(r=setTimeout(function(){clearTimeout(r),r=null,t()},5));case"keydown":0!==n.length&&"keypress"===n[0].type&&(!n[0].escape||i.keysym&&i.keysym.keysym===n[0].keysym.keysym||(i.escape=n[0].escape),i.keysym=n[0].keysym,n=n.splice(1))}"stall"!==i.type&&e(i)}}var n=[],r=null;return function(e){n.push(e),t()}}function TrackKeyState(e){"use strict";var t=[];return function(n){var r=0!==t.length?t[t.length-1]:null;switch(n.type){case"keydown":r&&n.keyId&&r.keyId===n.keyId||(r={keyId:n.keyId,keysyms:{}},t.push(r)),n.keysym&&(r.keysyms[n.keysym.keysym]=n.keysym,r.ignoreKeyPress=!0,e(n));break;case"keypress":r||(r={keyId:n.keyId,keysyms:{}},t.push(r)),n.keysym||console.log("keypress with no keysym:",n),n.keysym&&!r.ignoreKeyPress&&(r.keysyms[n.keysym.keysym]=n.keysym,n.type="keydown",e(n));break;case"keyup":if(0===t.length)return;for(var i=null,o=0;o!==t.length;++o)if(t[o].keyId===n.keyId){i=o;break}null===i&&(i=t.length-1);var s=t.splice(i,1)[0];for(var a in s.keysyms){var l=function(){function e(){}return function(t){return e.prototype=t,new e}}(),u=l(n);u.keysym=s.keysyms[a],e(u)}break;case"releaseall":for(var o=0;o<t.length;++o)for(var a in t[o].keysyms){var c=t[o].keysyms[a];e({keyId:0,keysym:c,type:"keyup"})}t=[]}}}function EscapeModifiers(e){"use strict";return function(t){if("keydown"!==t.type||void 0===t.escape)return void e(t);for(var n=0;n<t.escape.length;++n)e({type:"keyup",keyId:0,keysym:keysyms.lookup(t.escape[n])});e(t);for(var n=0;n<t.escape.length;++n)e({type:"keydown",keyId:0,keysym:keysyms.lookup(t.escape[n])})}}/*
 * noVNC: HTML5 VNC client
 * Copyright (C) 2012 Joel Martin
 * Copyright (C) 2013 Samuel Mannehed for Cendio AB
 * Licensed under MPL 2.0 (see LICENSE.txt)
 *
 * See README.md for usage and integration instructions.
 *
 * TIGHT decoder portion:
 * (c) 2012 Michael Tinglof, Joe Balaz, Les Piech (Mercuri.ca)
 */
function RFB(e){"use strict";function t(){var e,t;for(Util.Debug(">> RFB.constructor"),e=0;e<F.length;e+=1)W[F[e][1]]=W[F[e][0]],B[F[e][1]]=F[e][0],O[F[e][1]]=[0,0];try{L=new Display({target:E.target})}catch(n){Util.Error("Display exception: "+n),s("fatal","No working Display")}return q=new Keyboard({target:E.focusContainer,onKeyPress:k}),H=new Mouse({target:E.target,onMouseButton:C,onMouseMove:_,notify:q.sync}),t=L.get_render_mode(),P=new Websock,P.on("message",l),P.on("open",function(){"connect"===$?s("ProtocolVersion","Starting VNC handshake"):a("Got unexpected WebSockets connection")}),P.on("close",function(e){Util.Warn("WebSocket on-close event");var t="";e.code&&(t=" (code: "+e.code,e.reason&&(t+=", reason: "+e.reason),t+=")"),"disconnect"===$?s("disconnected","VNC disconnected"+t):"ProtocolVersion"===$?a("Failed to connect to server"+t):$ in{failed:1,disconnected:1}?Util.Error("Received onclose while disconnected"+t):a("Server disconnected"+t)}),P.on("error",function(){Util.Warn("WebSocket on-error event")}),o(),Websock_native?(Util.Info("Using native WebSockets"),s("loaded","noVNC ready: native WebSockets, "+t)):(Util.Warn("Using web-socket-js bridge. Flash version: "+Util.Flash.version),!Util.Flash||Util.Flash.version<9?s("fatal","WebSockets or <a href='http://get.adobe.com/flashplayer'>Adobe Flash</a> is required"):"file://"===document.location.href.substr(0,7)?s("fatal","'file://' URL is incompatible with Adobe Flash"):s("loaded","noVNC ready: WebSockets emulation, "+t)),Util.Debug("<< RFB.constructor"),T}function n(){Util.Debug(">> RFB.connect");var e;e="undefined"!=typeof UsingSocketIO?"http":E.encrypt?"wss":"ws",e+="://"+S+":"+D+"/"+A,Util.Info("connecting to "+e),P.open(e,E.wsProtocols),Util.Debug("<< RFB.connect")}function r(e,t){var n,r=[];for(n=0;n<e.length;n+=1)r.push(e.charCodeAt(n));return new DES(r).encrypt(t)}function i(e){1===Y&&a("Tight protocol handler only implements true color mode");var t,n,r,i,o,s,l=-1,u=0,c=-1,d=P.get_rQ(),f=P.get_rQi();if(X.bytes=1,P.rQwait("TIGHT compression-control",X.bytes))return!1;var h=function(e){for(var t=0;4>t;t++)u>>t&1&&(X.zlibs[t].reset(),Util.Info("Reset zlib stream "+t));var n=X.zlibs[c].uncompress(e,0);return 0!==n.status&&Util.Error("Invalid data in zlib stream"),n.data},p=function(e,t,n,r,i){var o,s,a,l,u,c,d,f=[];if(2===t)for(l=Math.floor((r+7)/8),u=Math.floor(r/8),s=0;i>s;s++){for(o=0;u>o;o++)for(a=7;a>=0;a--)c=3*(s*r+8*o+7-a),d=3*(e[s*l+o]>>a&1),f[c]=n[d],f[c+1]=n[d+1],f[c+2]=n[d+2];for(a=7;a>=8-r%8;a--)c=3*(s*r+8*o+7-a),d=3*(e[s*l+o]>>a&1),f[c]=n[d],f[c+1]=n[d+1],f[c+2]=n[d+2]}else for(s=0;i>s;s++)for(o=0;r>o;o++)c=3*(s*r+o),d=3*e[s*r+o],f[c]=n[d],f[c+1]=n[d+1],f[c+2]=n[d+2];return f},g=function(){var e=d[f+2]+1,t=e*Y;if(X.bytes+=t,P.rQwait("TIGHT palette "+n,X.bytes))return!1;var i=2>=e?1:8,o=Math.floor((X.width*i+7)/8),a=!1;if(o*X.height<12?(a=!0,r=[0,o*X.height]):r=w(P.rQslice(3+t,3+t+3)),X.bytes+=r[0]+r[1],P.rQwait("TIGHT "+n,X.bytes))return!1;P.rQshiftBytes(3);var l=P.rQshiftBytes(t);P.rQshiftBytes(r[0]),s=a?P.rQshiftBytes(r[1]):h(P.rQshiftBytes(r[1]));var u=p(s,e,l,X.width,X.height);return L.renderQ_push({type:"blitRgb",data:u,x:X.x,y:X.y,width:X.width,height:X.height}),!0},y=function(){var e=!1,t=X.width*X.height*Y;return 12>t?(e=!0,r=[0,t]):r=w(P.rQslice(1,4)),X.bytes=1+r[0]+r[1],P.rQwait("TIGHT "+n,X.bytes)?!1:(P.rQshiftBytes(1+r[0]),s=e?P.rQshiftBytes(r[1]):h(P.rQshiftBytes(r[1])),L.renderQ_push({type:"blitRgb",data:s,x:X.x,y:X.y,width:X.width,height:X.height}),!0)};if(t=P.rQpeek8(),u=15&t,t>>=4,c=3&t,8===t)n="fill";else if(9===t)n="jpeg";else if(10===t)n="png";else if(4&t)n="filter";else{if(!(4>t))return a("Illegal tight compression received, ctl: "+t);n="copy"}if(e&&("filter"===n||"copy"===n))return a("filter/copy received in tightPNG mode");switch(n){case"fill":X.bytes+=Y;break;case"jpeg":X.bytes+=3;break;case"png":X.bytes+=3;break;case"filter":X.bytes+=2;break;case"copy":}if(P.rQwait("TIGHT "+n,X.bytes))return!1;switch(n){case"fill":P.rQshift8(),i=P.rQshiftBytes(Y),L.renderQ_push({type:"fill",x:X.x,y:X.y,width:X.width,height:X.height,color:[i[2],i[1],i[0]]});break;case"png":case"jpeg":if(r=w(P.rQslice(1,4)),X.bytes=1+r[0]+r[1],P.rQwait("TIGHT "+n,X.bytes))return!1;P.rQshiftBytes(1+r[0]),o=new Image,o.src="data:image/"+n+x(P.rQshiftBytes(r[1])),L.renderQ_push({type:"img",img:o,x:X.x,y:X.y}),o=null;break;case"filter":if(l=d[f+1],1!==l)throw"Unsupported tight subencoding received, filter: "+l;if(!g())return!1;break;case"copy":if(!y())return!1}return X.bytes=0,X.rects-=1,!0}var o,s,a,l,u,c,d,f,h,p,g,y,m,v,b,w,x,k,C,_,U,T={},E={},S="",D=5900,I="",A="",$="disconnected",Q=0,M=3.8,R="",j=!1,N=0,F=[["COPYRECT",1],["TIGHT",7],["TIGHT_PNG",-260],["HEXTILE",5],["RRE",2],["RAW",0],["DesktopSize",-223],["Cursor",-239],["JPEG_quality_med",-26],["compress_hi",-247],["last_rect",-224],["xvp",-309]],W={},B={},O={},P=null,L=null,q=null,H=null,K=null,z=null,V=null,X={rects:0,subrects:0,lines:0,tiles:0,bytes:0,x:0,y:0,width:0,height:0,encoding:0,subencoding:-1,background:null,zlibs:[]},G=4,Y=3,J=0,Z=0,et="",tt=100,nt={last_fbu:0,fbu_total:0,fbu_total_cnt:0,full_fbu_total:0,full_fbu_cnt:0,fbu_rt_start:0,fbu_rt_total:0,fbu_rt_cnt:0,pixels:0},rt=!1,it=0,ot=[],st=!1,at={};return Util.conf_defaults(E,T,e,[["target","wo","dom",null,"VNC display rendering Canvas object"],["focusContainer","wo","dom",document,"DOM element that captures keyboard input"],["encrypt","rw","bool",!1,"Use TLS/SSL/wss encryption"],["true_color","rw","bool",!0,"Request true color pixel data"],["local_cursor","rw","bool",!1,"Request locally rendered cursor"],["shared","rw","bool",!0,"Request shared mode"],["view_only","rw","bool",!1,"Disable client mouse/keyboard"],["xvp_password_sep","rw","str","@","Separator for XVP password fields"],["disconnectTimeout","rw","int",3,"Time (s) to wait for disconnection"],["wsProtocols","rw","arr",["binary","base64"],"Protocols to use in the WebSocket connection"],["repeaterID","rw","str","","RepeaterID to connect to"],["viewportDrag","rw","bool",!1,"Move the viewport on mouse drags"],["onUpdateState","rw","func",function(){},"onUpdateState(rfb, state, oldstate, statusMsg): RFB state update/change "],["onPasswordRequired","rw","func",function(){},"onPasswordRequired(rfb): VNC password is required "],["onClipboard","rw","func",function(){},"onClipboard(rfb, text): RFB clipboard contents received"],["onBell","rw","func",function(){},"onBell(rfb): RFB Bell message received "],["onFBUReceive","rw","func",function(){},"onFBUReceive(rfb, fbu): RFB FBU received but not yet processed "],["onFBUComplete","rw","func",function(){},"onFBUComplete(rfb, fbu): RFB FBU received and processed "],["onFBResize","rw","func",function(){},"onFBResize(rfb, width, height): frame buffer resized"],["onDesktopName","rw","func",function(){},"onDesktopName(rfb, name): desktop name received"],["onXvpInit","rw","func",function(){},"onXvpInit(version): XVP extensions active for this connection"],["updateState","rw","func",function(){},"obsolete, use onUpdateState"],["clipboardReceive","rw","func",function(){},"obsolete, use onClipboard"]]),T.set_local_cursor=function(e){!e||e in{0:1,no:1,"false":1}?E.local_cursor=!1:L.get_cursor_uri()?E.local_cursor=!0:Util.Warn("Browser does not support local cursor")},T.get_display=function(){return L},T.get_keyboard=function(){return q},T.get_mouse=function(){return H},o=function(){var e;for(P.init(),X.rects=0,X.subrects=0,X.lines=0,X.tiles=0,X.zlibs=[],it=0,ot=[],e=0;e<F.length;e+=1)O[F[e][1]][0]=0;for(e=0;4>e;e++)X.zlibs[e]=new TINF,X.zlibs[e].init()},f=function(){var e,t;for(Util.Info("Encoding stats for this connection:"),e=0;e<F.length;e+=1)t=O[F[e][1]],t[0]+t[1]>0&&Util.Info("    "+F[e][0]+": "+t[0]+" rects");for(Util.Info("Encoding stats since page load:"),e=0;e<F.length;e+=1)t=O[F[e][1]],t[0]+t[1]>0&&Util.Info("    "+F[e][0]+": "+t[1]+" rects")},s=function(e,t){var r,i,l=$;if(e===l)return void Util.Debug("Already in state '"+e+"', ignoring.");switch(e in{disconnected:1,loaded:1,connect:1,disconnect:1,failed:1,fatal:1}&&(K&&(clearInterval(K),K=null),V&&(clearTimeout(V),V=null),L&&L.get_context()&&(q.ungrab(),H.ungrab(),L.defaultCursor(),("debug"!==Util.get_logging()||"loaded"===e)&&L.clear()),P.close()),"fatal"===l&&Util.Error("Fatal error, cannot continue"),r="failed"===e||"fatal"===e?Util.Error:Util.Warn,i="undefined"!=typeof t?" Msg: "+t:"",r("New state '"+e+"', was '"+l+"'."+i),$="failed"===l&&"disconnected"===e?"failed":e,z&&"disconnect"!==$&&(Util.Debug("Clearing disconnect timer"),clearTimeout(z),z=null),e){case"normal":("disconnected"===l||"failed"===l)&&Util.Error("Invalid transition from 'disconnected' or 'failed' to 'normal'");break;case"connect":o(),n();break;case"disconnect":rt||(z=setTimeout(function(){a("Disconnect timeout")},1e3*E.disconnectTimeout)),f();break;case"failed":"disconnected"===l&&Util.Error("Invalid transition from 'disconnected' to 'failed'"),"normal"===l&&Util.Error("Error while connected."),"init"===l&&Util.Error("Error while initializing."),setTimeout(function(){s("disconnected")},50)}"failed"===l&&"disconnected"===e?(E.updateState(T,e,l),E.onUpdateState(T,e,l)):(E.updateState(T,e,l,t),E.onUpdateState(T,e,l,t))},a=function(e){return s("failed",e),!1},l=function(){if(0===P.rQlen())return void Util.Warn("handle_message called on empty receive queue");switch($){case"disconnected":case"failed":Util.Error("Got data while disconnected");break;case"normal":c()&&P.rQlen()>0&&(null===V?(Util.Debug("More data to process, creating timer"),V=setTimeout(function(){V=null,l()},10)):Util.Debug("More data to process, existing timer"));break;default:u()}},U=function(){"normal"===$&&!st&&ot.length>0&&(P.send(ot),ot=[])},k=function(e,t){E.view_only||P.send(m(e,t))},C=function(e,t,n,r){if(n?it|=r:it^=r,E.viewportDrag){if(n&&!st)return st=!0,void(at={x:e,y:t});st=!1}E.view_only||(ot=ot.concat(v(L.absX(e),L.absY(t))),P.send(ot),ot=[])},_=function(e,t){var n,r;return st?(n=at.x-e,r=at.y-t,at={x:e,y:t},void L.viewportChange(n,r)):void(E.view_only||(ot=ot.concat(v(L.absX(e),L.absY(t))),U()))},u=function(){var e,t,n,i,o,l,c,d,f,g,m,v,b,w,x,k,C,_,S,D,A,N,F,W,B,O;switch($){case"ProtocolVersion":if(P.rQlen()<12)return a("Incomplete protocol version");switch(i=P.rQshiftStr(12).substr(4,7),Util.Info("Server ProtocolVersion: "+i),F=0,i){case"000.000":F=1;break;case"003.003":Q=3.3;break;case"003.006":Q=3.3;break;case"003.889":Q=3.3;break;case"003.007":Q=3.7;break;case"003.008":Q=3.8;break;case"004.000":Q=3.8;break;case"004.001":Q=3.8;break;default:return a("Invalid server version "+i)}if(F){for(l=E.repeaterID;l.length<250;)l+="\x00";P.send_string(l);break}Q>M&&(Q=M),rt||(K=setInterval(function(){P.flush()},50)),o="00"+parseInt(Q,10)+".00"+10*Q%10,P.send_string("RFB "+o+"\n"),s("Security","Sent ProtocolVersion: "+o);break;case"Security":if(Q>=3.7){if(f=P.rQshift8(),P.rQwait("security type",f,1))return!1;if(0===f)return e=P.rQshift32(),t=P.rQshiftStr(e),a("Security failure: "+t);for(R=0,d=P.rQshiftBytes(f),Util.Debug("Server security types: "+d),c=0;c<d.length;c+=1)d[c]>R&&(d[c]<=16||22==d[c])&&(R=d[c]);if(0===R)return a("Unsupported security types: "+d);P.send([R])}else{if(P.rQwait("security scheme",4))return!1;R=P.rQshift32()}s("Authentication","Authenticating using scheme: "+R),u();break;case"Authentication":switch(R){case 0:return P.rQwait("auth reason",4)?!1:(e=P.rQshift32(),t=P.rQshiftStr(e),a("Auth failure: "+t));case 1:if(Q>=3.8)return void s("SecurityResult");break;case 22:if(W=E.xvp_password_sep,B=I.split(W),B.length<3)return s("password","XVP credentials required (user"+W+"target"+W+"password) -- got only "+I),void E.onPasswordRequired(T);O=String.fromCharCode(B[0].length)+String.fromCharCode(B[1].length)+B[0]+B[1],P.send_string(O),I=B.slice(2).join(W),R=2;case 2:return 0===I.length?(s("password","Password Required"),void E.onPasswordRequired(T)):P.rQwait("auth challenge",16)?!1:(g=P.rQshiftBytes(16),m=r(I,g),P.send(m),void s("SecurityResult"));case 16:if(P.rQwait("num tunnels",4))return!1;var z=P.rQshift32();if(j=!0,0!=z)return void a("Protocol requested tunnels, not currently supported. numTunnels: "+z);var V={STDVNOAUTH__:1,STDVVNCAUTH_:2},X=[];if(P.rQwait("sub auth count",4))return!1;for(var tt=P.rQshift32(),c=0;tt>c;c++){if(P.rQwait("sub auth capabilities "+c,16))return!1;var it=(P.rQshift32(),P.rQshiftStr(12));X.push(it)}for(var ot in V)if(-1!=X.indexOf(ot))switch(P.send([0,0,0,V[ot]]),ot){case"STDVNOAUTH__":return void s("SecurityResult");case"STDVVNCAUTH_":return R=2,void u();default:return void a("Unsupported tiny auth scheme: "+ot)}return;default:return void a("Unsupported auth scheme: "+R)}s("ClientInitialisation","No auth required"),u();break;case"SecurityResult":if(P.rQwait("VNC auth response ",4))return!1;switch(P.rQshift32()){case 0:break;case 1:if(Q>=3.8){if(n=P.rQshift32(),P.rQwait("SecurityResult reason",n,8))return!1;t=P.rQshiftStr(n),a(t)}else a("Authentication failed");return;case 2:return a("Too many auth attempts")}s("ClientInitialisation","Authentication OK"),u();break;case"ClientInitialisation":P.send([E.shared?1:0]),s("ServerInitialisation","Authentication OK");break;case"ServerInitialisation":if(P.rQwait("server initialization",24))return!1;if(J=P.rQshift16(),Z=P.rQshift16(),v=P.rQshift8(),b=P.rQshift8(),w=P.rQshift8(),A=P.rQshift8(),x=P.rQshift16(),k=P.rQshift16(),C=P.rQshift16(),_=P.rQshift8(),S=P.rQshift8(),D=P.rQshift8(),P.rQshiftStr(3),Util.Info("Screen: "+J+"x"+Z+", bpp: "+v+", depth: "+b+", big_endian: "+w+", true_color: "+A+", red_max: "+x+", green_max: "+k+", blue_max: "+C+", red_shift: "+_+", green_shift: "+S+", blue_shift: "+D),0!==w&&Util.Warn("Server native endian is not little endian"),16!==_&&Util.Warn("Server native red-shift is not 16"),0!==D&&Util.Warn("Server native blue-shift is not 0"),N=P.rQshift32(),et=Util.decodeUTF8(P.rQshiftStr(N)),E.onDesktopName(T,et),E.true_color&&"Intel(r) AMT KVM"===et&&(Util.Warn("Intel AMT KVM only support 8/16 bit depths. Disabling true color"),E.true_color=!1),j){var st=P.rQshift16(),at=P.rQshift16(),lt=P.rQshift16();P.rQshift16();for(var c=0;st>c;c++){P.rQshiftStr(16)}for(var c=0;at>c;c++){P.rQshiftStr(16)}for(var c=0;lt>c;c++){P.rQshiftStr(16)}}L.set_true_color(E.true_color),E.onFBResize(T,J,Z),L.resize(J,Z),q.grab(),H.grab(),E.true_color?(G=4,Y=3):(G=1,Y=1),m=h(),m=m.concat(p()),m=m.concat(y()),nt.fbu_rt_start=(new Date).getTime(),nt.pixels=0,P.send(m),U(),E.encrypt?s("normal","Connected (encrypted) to: "+et):s("normal","Connected (unencrypted) to: "+et)}},c=function(){var e,t,n,r,i,o,l,u,c,f,h,p=!0;switch(e=X.rects>0?0:P.rQshift8()){case 0:p=d(),p&&P.send(y());break;case 1:if(Util.Debug("SetColourMapEntries"),P.rQshift8(),i=P.rQshift16(),o=P.rQshift16(),P.rQwait("SetColourMapEntries",6*o,6))return!1;for(r=0;o>r;r+=1)l=P.rQshift16(),l=parseInt(l/256,10),u=parseInt(P.rQshift16()/256,10),c=parseInt(P.rQshift16()/256,10),L.set_colourMap([c,u,l],i+r);Util.Debug("colourMap: "+L.get_colourMap()),Util.Info("Registered "+o+" colourMap entries");break;case 2:Util.Debug("Bell"),E.onBell(T);break;case 3:if(Util.Debug("ServerCutText"),P.rQwait("ServerCutText header",7,1))return!1;if(P.rQshiftBytes(3),t=P.rQshift32(),P.rQwait("ServerCutText",t,8))return!1;n=P.rQshiftStr(t),E.clipboardReceive(T,n),E.onClipboard(T,n);break;case 250:switch(P.rQshift8(),f=P.rQshift8(),h=P.rQshift8()){case 0:s($,"Operation failed");break;case 1:N=f,Util.Info("XVP extensions enabled (version "+N+")"),E.onXvpInit(N);break;default:a("Disconnected: illegal server XVP message "+h)}break;default:a("Disconnected: illegal server message type "+e),Util.Debug("ws.rQslice(0,30):"+P.rQslice(0,30))}return p},d=function(){var e,t,n,r=!0;if(0===X.rects){if(P.rQwait("FBU header",3))return P.rQunshift8(0),!1;P.rQshift8(),X.rects=P.rQshift16(),X.bytes=0,nt.cur_fbu=0,nt.fbu_rt_start>0&&(e=(new Date).getTime(),Util.Info("First FBU latency: "+(e-nt.fbu_rt_start)))}for(;X.rects>0;){if("normal"!==$)return!1;if(P.rQwait("FBU",X.bytes))return!1;if(0===X.bytes){if(P.rQwait("rect header",12))return!1;if(t=P.rQshiftBytes(12),X.x=(t[0]<<8)+t[1],X.y=(t[2]<<8)+t[3],X.width=(t[4]<<8)+t[5],X.height=(t[6]<<8)+t[7],X.encoding=parseInt((t[8]<<24)+(t[9]<<16)+(t[10]<<8)+t[11],10),E.onFBUReceive(T,{x:X.x,y:X.y,width:X.width,height:X.height,encoding:X.encoding,encodingName:B[X.encoding]}),!B[X.encoding])return a("Disconnected: unsupported encoding "+X.encoding),!1}if(nt.last_fbu=(new Date).getTime(),r=W[X.encoding](),e=(new Date).getTime(),nt.cur_fbu+=e-nt.last_fbu,r&&(O[X.encoding][0]+=1,O[X.encoding][1]+=1,nt.pixels+=X.width*X.height),nt.pixels>=J*Z&&((X.width===J&&X.height===Z||nt.fbu_rt_start>0)&&(nt.full_fbu_total+=nt.cur_fbu,nt.full_fbu_cnt+=1,Util.Info("Timing of full FBU, cur: "+nt.cur_fbu+", total: "+nt.full_fbu_total+", cnt: "+nt.full_fbu_cnt+", avg: "+nt.full_fbu_total/nt.full_fbu_cnt)),nt.fbu_rt_start>0&&(n=e-nt.fbu_rt_start,nt.fbu_rt_total+=n,nt.fbu_rt_cnt+=1,Util.Info("full FBU round-trip, cur: "+n+", total: "+nt.fbu_rt_total+", cnt: "+nt.fbu_rt_cnt+", avg: "+nt.fbu_rt_total/nt.fbu_rt_cnt),nt.fbu_rt_start=0)),!r)return r}return E.onFBUComplete(T,{x:X.x,y:X.y,width:X.width,height:X.height,encoding:X.encoding,encodingName:B[X.encoding]}),!0},W.RAW=function(){var e,t;return 0===X.lines&&(X.lines=X.height),X.bytes=X.width*G,P.rQwait("RAW",X.bytes)?!1:(e=X.y+(X.height-X.lines),t=Math.min(X.lines,Math.floor(P.rQlen()/(X.width*G))),L.blitImage(X.x,e,X.width,t,P.get_rQ(),P.get_rQi()),P.rQshiftBytes(X.width*t*G),X.lines-=t,X.lines>0?X.bytes=X.width*G:(X.rects-=1,X.bytes=0),!0)},W.COPYRECT=function(){return X.bytes=4,P.rQwait("COPYRECT",4)?!1:(L.renderQ_push({type:"copy",old_x:P.rQshift16(),old_y:P.rQshift16(),x:X.x,y:X.y,width:X.width,height:X.height}),X.rects-=1,X.bytes=0,!0)},W.RRE=function(){var e,t,n,r,i,o;if(0===X.subrects){if(X.bytes=4+G,P.rQwait("RRE",4+G))return!1;X.subrects=P.rQshift32(),e=P.rQshiftBytes(G),L.fillRect(X.x,X.y,X.width,X.height,e)}for(;X.subrects>0&&P.rQlen()>=G+8;)e=P.rQshiftBytes(G),t=P.rQshift16(),n=P.rQshift16(),r=P.rQshift16(),i=P.rQshift16(),L.fillRect(X.x+t,X.y+n,r,i,e),X.subrects-=1;return X.subrects>0?(o=Math.min(tt,X.subrects),X.bytes=(G+8)*o):(X.rects-=1,X.bytes=0),!0},W.HEXTILE=function(){var e,t,n,r,i,o,s,l,u,c,d,f,h,p,g,y,m,v=P.get_rQ(),b=P.get_rQi();for(0===X.tiles&&(X.tiles_x=Math.ceil(X.width/16),X.tiles_y=Math.ceil(X.height/16),X.total_tiles=X.tiles_x*X.tiles_y,X.tiles=X.total_tiles);X.tiles>0;){if(X.bytes=1,P.rQwait("HEXTILE subencoding",X.bytes))return!1;if(e=v[b],e>30)return a("Disconnected: illegal hextile subencoding "+e),!1;if(t=0,r=X.total_tiles-X.tiles,i=r%X.tiles_x,l=Math.floor(r/X.tiles_x),o=X.x+16*i,u=X.y+16*l,s=Math.min(16,X.x+X.width-o),c=Math.min(16,X.y+X.height-u),1&e)X.bytes+=s*c*G;else if(2&e&&(X.bytes+=G),4&e&&(X.bytes+=G),8&e){if(X.bytes+=1,P.rQwait("hextile subrects header",X.bytes))return!1;t=v[b+X.bytes-1],X.bytes+=16&e?t*(G+2):2*t}if(P.rQwait("hextile",X.bytes))return!1;if(X.subencoding=v[b],b+=1,0===X.subencoding)1&X.lastsubencoding?Util.Debug("     Ignoring blank after RAW"):L.fillRect(o,u,s,c,X.background);else if(1&X.subencoding)L.blitImage(o,u,s,c,v,b),b+=X.bytes-1;else{if(2&X.subencoding&&(X.background=v.slice(b,b+G),b+=G),4&X.subencoding&&(X.foreground=v.slice(b,b+G),b+=G),L.startTile(o,u,s,c,X.background),8&X.subencoding)for(t=v[b],b+=1,f=0;t>f;f+=1)16&X.subencoding?(n=v.slice(b,b+G),b+=G):n=X.foreground,d=v[b],b+=1,h=d>>4,p=15&d,g=v[b],b+=1,y=(g>>4)+1,m=(15&g)+1,L.subTile(h,p,y,m,n);L.finishTile()}P.set_rQi(b),X.lastsubencoding=X.subencoding,X.bytes=0,X.tiles-=1}return 0===X.tiles&&(X.rects-=1),!0},w=function(e){var t=1,n=0;return n+=127&e[0],128&e[0]&&(t+=1,n+=(127&e[1])<<7,128&e[1]&&(t+=1,n+=e[2]<<14)),[t,n]},x=function(e){return";base64,"+Base64.encode(e)},W.TIGHT=function(){return i(!1)},W.TIGHT_PNG=function(){return i(!0)},W.last_rect=function(){return X.rects=0,!0},W.DesktopSize=function(){return Util.Debug(">> set_desktopsize"),J=X.width,Z=X.height,E.onFBResize(T,J,Z),L.resize(J,Z),nt.fbu_rt_start=(new Date).getTime(),X.bytes=0,X.rects-=1,Util.Debug("<< set_desktopsize"),!0},W.Cursor=function(){var e,t,n,r,i,o;return Util.Debug(">> set_cursor"),e=X.x,t=X.y,n=X.width,r=X.height,i=n*r*G,o=Math.floor((n+7)/8)*r,X.bytes=i+o,P.rQwait("cursor encoding",X.bytes)?!1:(L.changeCursor(P.rQshiftBytes(i),P.rQshiftBytes(o),e,t,n,r),X.bytes=0,X.rects-=1,Util.Debug("<< set_cursor"),!0)},W.JPEG_quality_lo=function(){Util.Error("Server sent jpeg_quality pseudo-encoding")},W.compress_lo=function(){Util.Error("Server sent compress level pseudo-encoding")},h=function(){var e;return e=[0],e.push8(0),e.push8(0),e.push8(0),e.push8(8*G),e.push8(8*Y),e.push8(0),e.push8(E.true_color?1:0),e.push16(255),e.push16(255),e.push16(255),e.push8(16),e.push8(8),e.push8(0),e.push8(0),e.push8(0),e.push8(0),e},p=function(){var e,t,n=[];for(t=0;t<F.length;t+=1)"Cursor"!==F[t][0]||E.local_cursor?"TIGHT"!==F[t][0]||E.true_color?n.push(F[t][1]):Util.Warn("Skipping tight, only support with true color"):Util.Debug("Skipping Cursor pseudo-encoding");for(e=[2],e.push8(0),e.push16(n.length),t=0;t<n.length;t+=1)e.push32(n[t]);return e},g=function(e,t,n,r,i){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=J),"undefined"==typeof i&&(i=Z);var o;return o=[3],o.push8(e),o.push16(t),o.push16(n),o.push16(r),o.push16(i),o},y=function(){var e,t,n,r=L.getCleanDirtyReset(),i=[];for(t=r.cleanBox,t.w>0&&t.h>0&&(i=i.concat(g(1,t.x,t.y,t.w,t.h))),e=0;e<r.dirtyBoxes.length;e++)n=r.dirtyBoxes[e],i=i.concat(g(0,n.x,n.y,n.w,n.h));return i},m=function(e,t){var n;return n=[4],n.push8(t),n.push16(0),n.push32(e),n},v=function(e,t){var n;return n=[5],n.push8(it),n.push16(e),n.push16(t),n},b=function(e){var t,n,r;for(t=[6],t.push8(0),t.push8(0),t.push8(0),t.push32(e.length),r=e.length,n=0;r>n;n+=1)t.push(e.charCodeAt(n));return t},T.connect=function(e,t,n,r){return S=e,D=t,I=void 0!==n?n:"",A=void 0!==r?r:"",S&&D?void s("connect"):a("Must set host and port")},T.disconnect=function(){s("disconnect","Disconnecting")},T.sendPassword=function(e){I=e,$="Authentication",setTimeout(u,1)},T.sendCtrlAltDel=function(){if("normal"!==$||E.view_only)return!1;Util.Info("Sending Ctrl-Alt-Del");var e=[];e=e.concat(m(65507,1)),e=e.concat(m(65513,1)),e=e.concat(m(65535,1)),e=e.concat(m(65535,0)),e=e.concat(m(65513,0)),e=e.concat(m(65507,0)),P.send(e)},T.xvpOp=function(e,t){return e>N?!1:(Util.Info("Sending XVP operation "+t+" (version "+e+")"),P.send_string("\xfa\x00"+String.fromCharCode(e)+String.fromCharCode(t)),!0)},T.xvpShutdown=function(){return T.xvpOp(1,2)},T.xvpReboot=function(){return T.xvpOp(1,3)},T.xvpReset=function(){return T.xvpOp(1,4)},T.sendKey=function(e,t){if("normal"!==$||E.view_only)return!1;var n=[];"undefined"!=typeof t?(Util.Info("Sending key code ("+(t?"down":"up")+"): "+e),n=n.concat(m(e,t?1:0))):(Util.Info("Sending key code (down + up): "+e),n=n.concat(m(e,1)),n=n.concat(m(e,0))),P.send(n)},T.clipboardPasteFrom=function(e){"normal"===$&&P.send(b(e))},T.testMode=function(e,t){rt=!0,T.recv_message=P.testMode(e,t),U=function(){},T.connect=function(e,t,n){S=e,D=t,I=n,o(),s("ProtocolVersion","Starting VNC handshake")}},t()}function Websock(){"use strict";function e(){return $}function t(){return D}function n(){return I}function r(e){I=e}function i(){return D.length-I}function o(){return D[I]}function s(){return D[I++]}function a(e){0===I?D.unshift(e):(I-=1,D[I]=e)}function l(){return(D[I++]<<8)+D[I++]}function u(){return(D[I++]<<24)+(D[I++]<<16)+(D[I++]<<8)+D[I++]}function c(e){"undefined"==typeof e&&(e=i());var t=D.slice(I,I+e);return I+=e,String.fromCharCode.apply(null,t)}function d(e){return"undefined"==typeof e&&(e=i()),I+=e,D.slice(I-e,I)}function f(e,t){return t?D.slice(I+e,I+t):D.slice(I+e)}function h(e,t,n){var r=D.length-I;if(t>r){if(n){if(n>I)throw"rQwait cannot backup "+n+" bytes";I-=n}return!0}return!1}function p(){return"binary"===S?new Uint8Array($).buffer:Base64.encode($)}function g(e){if("binary"===S)for(var t=new Uint8Array(e),n=0;n<t.length;n++)D.push(t[n]);else D=D.concat(Base64.decode(e,0))}function y(){return 0!==E.bufferedAmount&&Util.Debug("bufferedAmount: "+E.bufferedAmount),E.bufferedAmount<T.maxBufferedAmount?($.length>0&&(E.send(p($)),$=[]),!0):(Util.Info("Delaying send, bufferedAmount: "+E.bufferedAmount),!1)}function m(e){return $=$.concat(e),y()}function v(e){T.send(e.split("").map(function(e){return e.charCodeAt(0)}))}function b(e){try{g(e.data),i()>0?(Q.message(),D.length>A&&(D=D.slice(I),I=0)):Util.Debug("Ignoring empty message")}catch(t){Util.Warn("undefined"!=typeof t.stack?"recv_message, caught exception: "+t.stack:"undefined"!=typeof t.description?"recv_message, caught exception: "+t.description:"recv_message, caught exception:"+t),Q.error("undefined"!=typeof t.name?t.name+": "+t.message:t)}}function w(e,t){Q[e]=t}function x(e){D=[],I=0,$=[],E=null;var t=!1,n=!1;"Uint8Array"in window&&"set"in Uint8Array.prototype&&(t=!0);try{t&&"binaryType"in new WebSocket("ws://localhost:17523")&&(Util.Info("Detected binaryType support in WebSockets"),n=!0)}catch(r){}if("undefined"==typeof e&&(e=n?["binary","base64"]:"base64"),!n){if("binary"===e)throw"WebSocket binary sub-protocol requested but not supported";if("object"==typeof e){for(var i=[],o=0;o<e.length;o++)"binary"===e[o]?Util.Error("Skipping unsupported WebSocket binary sub-protocol"):i.push(e[o]);if(!(i.length>0))throw"Only WebSocket binary sub-protocol was requested and not supported.";e=i}}return e}function k(e,t){t=x(t),M?E={}:(E=new WebSocket(e,t),t.indexOf("binary")>=0&&(E.binaryType="arraybuffer")),E.onmessage=b,E.onopen=function(){Util.Debug(">> WebSock.onopen"),E.protocol?(S=E.protocol,Util.Info("Server chose sub-protocol: "+E.protocol)):(S="base64",Util.Error("Server select no sub-protocol!: "+E.protocol)),Q.open(),Util.Debug("<< WebSock.onopen")},E.onclose=function(e){Util.Debug(">> WebSock.onclose"),Q.close(e),Util.Debug("<< WebSock.onclose")},E.onerror=function(e){Util.Debug(">> WebSock.onerror: "+e),Q.error(e),Util.Debug("<< WebSock.onerror")}}function C(){E&&((E.readyState===WebSocket.OPEN||E.readyState===WebSocket.CONNECTING)&&(Util.Info("Closing WebSocket connection"),E.close()),E.onmessage=function(){})}function _(e,t){return M=!0,S=t,T.send=e,T.close=function(){},b}function U(){return T.maxBufferedAmount=200,T.get_sQ=e,T.get_rQ=t,T.get_rQi=n,T.set_rQi=r,T.rQlen=i,T.rQpeek8=o,T.rQshift8=s,T.rQunshift8=a,T.rQshift16=l,T.rQshift32=u,T.rQshiftStr=c,T.rQshiftBytes=d,T.rQslice=f,T.rQwait=h,T.flush=y,T.send=m,T.send_string=v,T.on=w,T.init=x,T.open=k,T.close=C,T.testMode=_,T}var T={},E=null,S="base64",D=[],I=0,A=1e4,$=[],Q={message:function(){},open:function(){},close:function(){},error:function(){}},M=!1;return U()}var Base64={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode:function(e){"use strict";var t="",n=Base64.toBase64Table,r=e.length,i=r%3,o=0,s=0;for(o=0;r-2>o;o+=3)t+=n[e[o]>>2],t+=n[((3&e[o])<<4)+(e[o+1]>>4)],t+=n[((15&e[o+1])<<2)+(e[o+2]>>6)],t+=n[63&e[o+2]];return 2===i?(s=r-i,t+=n[e[s]>>2],t+=n[((3&e[s])<<4)+(e[s+1]>>4)],t+=n[(15&e[s+1])<<2],t+=n[64]):1===i&&(s=r-i,t+=n[e[s]>>2],t+=n[(3&e[s])<<4],t+=n[64],t+=n[64]),t},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(e,t){"use strict";t="undefined"!=typeof t?t:0;var n,r,i,o,s,a,l=Base64.toBinaryTable,u=Base64.base64Pad,c=0,d=0,f=e.indexOf("=")-t;for(0>f&&(f=e.length-t),r=3*(f>>2)+Math.floor(f%4/1.5),n=new Array(r),i=0,o=t;o<e.length;o++)s=l[127&e.charCodeAt(o)],a=e.charAt(o)===u,-1!==s?(d=d<<6|s,c+=6,c>=8&&(c-=8,a||(n[i++]=d>>c&255),d&=(1<<c)-1)):console.error("Illegal character code "+e.charCodeAt(o)+" at position "+o);if(c)throw{name:"Base64-Error",message:"Corrupted base64 string"};return n}},tinf,kbdUtil=function(){"use strict";function e(e){var t={536:350,537:351,538:354,539:355},n=t[e];return n?n:e}function t(){return navigator&&!!/mac/i.exec(navigator.platform)}function n(){return navigator&&!!/win/i.exec(navigator.platform)}function r(){return navigator&&!!/linux/i.exec(navigator.platform)}function i(e,t){var n={};for(var r in t)65505!==parseInt(r)&&(n[r]=t[r]);var i=0;for(var s in t)n[s]&&++i;return o(e,n)?i>e.length:i>0}function o(e,t){if(0===e.length)return!1;for(var n=0;n<e.length;++n)if(!t[e[n]])return!1;return!0}function s(e){function s(e,t){function n(e){return{keysym:keysyms.lookup(e),type:p[e]?"keydown":"keyup"}}var r=[];return void 0!==e.ctrlKey&&e.ctrlKey!==p[u]&&t!==u&&(p[u]=e.ctrlKey,r.push(n(u))),void 0!==e.altKey&&e.altKey!==p[c]&&t!==c&&(p[c]=e.altKey,r.push(n(c))),void 0!==e.altGraphKey&&e.altGraphKey!==p[d]&&t!==d&&(p[d]=e.altGraphKey,r.push(n(d))),void 0!==e.shiftKey&&e.shiftKey!==p[f]&&t!==f&&(p[f]=e.shiftKey,r.push(n(f))),void 0!==e.metaKey&&e.metaKey!==p[h]&&t!==h&&(p[h]=e.metaKey,r.push(n(h))),r}function a(e,t){var n=l(e),r=n?n.keysym:null;return null!==r&&void 0!==p[r]&&(p[r]=t),s(e,r)}var u=65507,c=65513,d=65027,f=65505,h=65511;e||(e=t()?[c]:n()?[c,u]:r()?[d]:[]);var p={};return p[u]=!1,p[c]=!1,p[d]=!1,p[f]=!1,p[h]=!1,{keydown:function(e){return a(e,!0)},keyup:function(e){return a(e,!1)},syncAny:function(e){return s(e)},hasShortcutModifier:function(){return i(e,p)},activeCharModifier:function(){return o(e,p)?e:null}}}function a(e){return"keyCode"in e&&"key"in e?e.key+":"+e.keyCode:"keyCode"in e?e.keyCode:e.key}function l(t){var n;if(t.char&&1===t.char.length?n=t.char.charCodeAt():t.charCode?n=t.charCode:t.keyCode&&"keypress"===t.type&&(n=t.keyCode),n){var r=keysyms.fromUnicode(e(n));if(r)return r}return t.keyCode?keysyms.lookup(u(t.keyCode,t.shiftKey)):t.which?keysyms.lookup(u(t.which,t.shiftKey)):null}function u(e,t){if("number"!=typeof e)return null;if(e>=48&&57>=e)return e;if(e>=65&&90>=e)return t?e:e+32;if(e>=96&&105>=e)return 65456+(e-96);switch(e){case 32:return 32;case 106:return 65450;case 107:return 65451;case 108:return 65452;case 109:return 65453;case 110:return 65454;case 111:return 65455;case 187:return 43;case 188:return 44;case 189:return 45;case 190:return 46}return c({keyCode:e})}function c(e){if(!e.keyCode)return null;var t=e.keyCode;if(t>=112&&135>=t)return 65470+t-112;switch(t){case 8:return 65288;case 13:return 65293;case 9:return 65289;case 27:return 65307;case 46:return 65535;case 36:return 65360;case 35:return 65367;case 33:return 65365;case 34:return 65366;case 45:return 65379;case 37:return 65361;case 38:return 65362;case 39:return 65363;case 40:return 65364;case 16:return 65505;case 17:return 65507;case 18:return 65513;case 224:return 65031;case 225:return 65027;case 91:return 65516;case 92:return 65517;case 93:return 65383;default:return null}}return{hasShortcutModifier:i,hasCharModifier:o,ModifierSync:s,getKey:a,getKeysym:l,keysymFromKeyCode:u,nonCharacterKey:c,substituteCodepoint:e}}(),keysyms=function(){"use strict";function e(e){return e?{keysym:e,keyname:t?t[e]:e}:void 0}var t=null,n={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,300:16777516,301:16777517,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,372:16777588,373:16777589,374:16777590,375:16777591,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,399:16777615,402:2294,415:16777631,416:16777632,417:16777633,431:16777647,432:16777648,437:16777653,438:16777654,439:16777655,466:16777681,486:16777702,487:16777703,601:16777817,629:16777845,658:16777874,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1170:16778386,1171:16778387,1174:16778390,1175:16778391,1178:16778394,1179:16778395,1180:16778396,1181:16778397,1186:16778402,1187:16778403,1198:16778414,1199:16778415,1200:16778416,1201:16778417,1202:16778418,1203:16778419,1206:16778422,1207:16778423,1208:16778424,1209:16778425,1210:16778426,1211:16778427,1240:16778456,1241:16778457,1250:16778466,1251:16778467,1256:16778472,1257:16778473,1262:16778478,1263:16778479,1329:16778545,1330:16778546,1331:16778547,1332:16778548,1333:16778549,1334:16778550,1335:16778551,1336:16778552,1337:16778553,1338:16778554,1339:16778555,1340:16778556,1341:16778557,1342:16778558,1343:16778559,1344:16778560,1345:16778561,1346:16778562,1347:16778563,1348:16778564,1349:16778565,1350:16778566,1351:16778567,1352:16778568,1353:16778569,1354:16778570,1355:16778571,1356:16778572,1357:16778573,1358:16778574,1359:16778575,1360:16778576,1361:16778577,1362:16778578,1363:16778579,1364:16778580,1365:16778581,1366:16778582,1370:16778586,1371:16778587,1372:16778588,1373:16778589,1374:16778590,1377:16778593,1378:16778594,1379:16778595,1380:16778596,1381:16778597,1382:16778598,1383:16778599,1384:16778600,1385:16778601,1386:16778602,1387:16778603,1388:16778604,1389:16778605,1390:16778606,1391:16778607,1392:16778608,1393:16778609,1394:16778610,1395:16778611,1396:16778612,1397:16778613,1398:16778614,1399:16778615,1400:16778616,1401:16778617,1402:16778618,1403:16778619,1404:16778620,1405:16778621,1406:16778622,1407:16778623,1408:16778624,1409:16778625,1410:16778626,1411:16778627,1412:16778628,1413:16778629,1414:16778630,1415:16778631,1417:16778633,1418:16778634,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1619:16778835,1620:16778836,1621:16778837,1632:16778848,1633:16778849,1634:16778850,1635:16778851,1636:16778852,1637:16778853,1638:16778854,1639:16778855,1640:16778856,1641:16778857,1642:16778858,1648:16778864,1657:16778873,1662:16778878,1670:16778886,1672:16778888,1681:16778897,1688:16778904,1700:16778916,1705:16778921,1711:16778927,1722:16778938,1726:16778942,1729:16778945,1740:16778956,1746:16778962,1748:16778964,1776:16778992,1777:16778993,1778:16778994,1779:16778995,1780:16778996,1781:16778997,1782:16778998,1783:16778999,1784:16779e3,1785:16779001,3458:16780674,3459:16780675,3461:16780677,3462:16780678,3463:16780679,3464:16780680,3465:16780681,3466:16780682,3467:16780683,3468:16780684,3469:16780685,3470:16780686,3471:16780687,3472:16780688,3473:16780689,3474:16780690,3475:16780691,3476:16780692,3477:16780693,3478:16780694,3482:16780698,3483:16780699,3484:16780700,3485:16780701,3486:16780702,3487:16780703,3488:16780704,3489:16780705,3490:16780706,3491:16780707,3492:16780708,3493:16780709,3494:16780710,3495:16780711,3496:16780712,3497:16780713,3498:16780714,3499:16780715,3500:16780716,3501:16780717,3502:16780718,3503:16780719,3504:16780720,3505:16780721,3507:16780723,3508:16780724,3509:16780725,3510:16780726,3511:16780727,3512:16780728,3513:16780729,3514:16780730,3515:16780731,3517:16780733,3520:16780736,3521:16780737,3522:16780738,3523:16780739,3524:16780740,3525:16780741,3526:16780742,3530:16780746,3535:16780751,3536:16780752,3537:16780753,3538:16780754,3539:16780755,3540:16780756,3542:16780758,3544:16780760,3545:16780761,3546:16780762,3547:16780763,3548:16780764,3549:16780765,3550:16780766,3551:16780767,3570:16780786,3571:16780787,3572:16780788,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,4304:16781520,4305:16781521,4306:16781522,4307:16781523,4308:16781524,4309:16781525,4310:16781526,4311:16781527,4312:16781528,4313:16781529,4314:16781530,4315:16781531,4316:16781532,4317:16781533,4318:16781534,4319:16781535,4320:16781536,4321:16781537,4322:16781538,4323:16781539,4324:16781540,4325:16781541,4326:16781542,4327:16781543,4328:16781544,4329:16781545,4330:16781546,4331:16781547,4332:16781548,4333:16781549,4334:16781550,4335:16781551,4336:16781552,4337:16781553,4338:16781554,4339:16781555,4340:16781556,4341:16781557,4342:16781558,7682:16784898,7683:16784899,7690:16784906,7691:16784907,7710:16784926,7711:16784927,7734:16784950,7735:16784951,7744:16784960,7745:16784961,7766:16784982,7767:16784983,7776:16784992,7777:16784993,7786:16785002,7787:16785003,7808:16785024,7809:16785025,7810:16785026,7811:16785027,7812:16785028,7813:16785029,7818:16785034,7819:16785035,7840:16785056,7841:16785057,7842:16785058,7843:16785059,7844:16785060,7845:16785061,7846:16785062,7847:16785063,7848:16785064,7849:16785065,7850:16785066,7851:16785067,7852:16785068,7853:16785069,7854:16785070,7855:16785071,7856:16785072,7857:16785073,7858:16785074,7859:16785075,7860:16785076,7861:16785077,7862:16785078,7863:16785079,7864:16785080,7865:16785081,7866:16785082,7867:16785083,7868:16785084,7869:16785085,7870:16785086,7871:16785087,7872:16785088,7873:16785089,7874:16785090,7875:16785091,7876:16785092,7877:16785093,7878:16785094,7879:16785095,7880:16785096,7881:16785097,7882:16785098,7883:16785099,7884:16785100,7885:16785101,7886:16785102,7887:16785103,7888:16785104,7889:16785105,7890:16785106,7891:16785107,7892:16785108,7893:16785109,7894:16785110,7895:16785111,7896:16785112,7897:16785113,7898:16785114,7899:16785115,7900:16785116,7901:16785117,7902:16785118,7903:16785119,7904:16785120,7905:16785121,7906:16785122,7907:16785123,7908:16785124,7909:16785125,7910:16785126,7911:16785127,7912:16785128,7913:16785129,7914:16785130,7915:16785131,7916:16785132,7917:16785133,7918:16785134,7919:16785135,7920:16785136,7921:16785137,7922:16785138,7923:16785139,7924:16785140,7925:16785141,7926:16785142,7927:16785143,7928:16785144,7929:16785145,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8304:16785520,8308:16785524,8309:16785525,8310:16785526,8311:16785527,8312:16785528,8313:16785529,8320:16785536,8321:16785537,8322:16785538,8323:16785539,8324:16785540,8325:16785541,8326:16785542,8327:16785543,8328:16785544,8329:16785545,8352:16785568,8353:16785569,8354:16785570,8355:16785571,8356:16785572,8357:16785573,8358:16785574,8359:16785575,8360:16785576,8361:3839,8362:16785578,8363:16785579,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8709:16785925,8711:2245,8712:16785928,8713:16785929,8715:16785931,8728:3018,8730:2262,8731:16785947,8732:16785948,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8748:16785964,8749:16785965,8756:2240,8757:16785973,8764:2248,8771:2249,8773:16785992,8775:16785991,8800:2237,8801:2255,8802:16786018,8803:16786019,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,10240:16787456,10241:16787457,10242:16787458,10243:16787459,10244:16787460,10245:16787461,10246:16787462,10247:16787463,10248:16787464,10249:16787465,10250:16787466,10251:16787467,10252:16787468,10253:16787469,10254:16787470,10255:16787471,10256:16787472,10257:16787473,10258:16787474,10259:16787475,10260:16787476,10261:16787477,10262:16787478,10263:16787479,10264:16787480,10265:16787481,10266:16787482,10267:16787483,10268:16787484,10269:16787485,10270:16787486,10271:16787487,10272:16787488,10273:16787489,10274:16787490,10275:16787491,10276:16787492,10277:16787493,10278:16787494,10279:16787495,10280:16787496,10281:16787497,10282:16787498,10283:16787499,10284:16787500,10285:16787501,10286:16787502,10287:16787503,10288:16787504,10289:16787505,10290:16787506,10291:16787507,10292:16787508,10293:16787509,10294:16787510,10295:16787511,10296:16787512,10297:16787513,10298:16787514,10299:16787515,10300:16787516,10301:16787517,10302:16787518,10303:16787519,10304:16787520,10305:16787521,10306:16787522,10307:16787523,10308:16787524,10309:16787525,10310:16787526,10311:16787527,10312:16787528,10313:16787529,10314:16787530,10315:16787531,10316:16787532,10317:16787533,10318:16787534,10319:16787535,10320:16787536,10321:16787537,10322:16787538,10323:16787539,10324:16787540,10325:16787541,10326:16787542,10327:16787543,10328:16787544,10329:16787545,10330:16787546,10331:16787547,10332:16787548,10333:16787549,10334:16787550,10335:16787551,10336:16787552,10337:16787553,10338:16787554,10339:16787555,10340:16787556,10341:16787557,10342:16787558,10343:16787559,10344:16787560,10345:16787561,10346:16787562,10347:16787563,10348:16787564,10349:16787565,10350:16787566,10351:16787567,10352:16787568,10353:16787569,10354:16787570,10355:16787571,10356:16787572,10357:16787573,10358:16787574,10359:16787575,10360:16787576,10361:16787577,10362:16787578,10363:16787579,10364:16787580,10365:16787581,10366:16787582,10367:16787583,10368:16787584,10369:16787585,10370:16787586,10371:16787587,10372:16787588,10373:16787589,10374:16787590,10375:16787591,10376:16787592,10377:16787593,10378:16787594,10379:16787595,10380:16787596,10381:16787597,10382:16787598,10383:16787599,10384:16787600,10385:16787601,10386:16787602,10387:16787603,10388:16787604,10389:16787605,10390:16787606,10391:16787607,10392:16787608,10393:16787609,10394:16787610,10395:16787611,10396:16787612,10397:16787613,10398:16787614,10399:16787615,10400:16787616,10401:16787617,10402:16787618,10403:16787619,10404:16787620,10405:16787621,10406:16787622,10407:16787623,10408:16787624,10409:16787625,10410:16787626,10411:16787627,10412:16787628,10413:16787629,10414:16787630,10415:16787631,10416:16787632,10417:16787633,10418:16787634,10419:16787635,10420:16787636,10421:16787637,10422:16787638,10423:16787639,10424:16787640,10425:16787641,10426:16787642,10427:16787643,10428:16787644,10429:16787645,10430:16787646,10431:16787647,10432:16787648,10433:16787649,10434:16787650,10435:16787651,10436:16787652,10437:16787653,10438:16787654,10439:16787655,10440:16787656,10441:16787657,10442:16787658,10443:16787659,10444:16787660,10445:16787661,10446:16787662,10447:16787663,10448:16787664,10449:16787665,10450:16787666,10451:16787667,10452:16787668,10453:16787669,10454:16787670,10455:16787671,10456:16787672,10457:16787673,10458:16787674,10459:16787675,10460:16787676,10461:16787677,10462:16787678,10463:16787679,10464:16787680,10465:16787681,10466:16787682,10467:16787683,10468:16787684,10469:16787685,10470:16787686,10471:16787687,10472:16787688,10473:16787689,10474:16787690,10475:16787691,10476:16787692,10477:16787693,10478:16787694,10479:16787695,10480:16787696,10481:16787697,10482:16787698,10483:16787699,10484:16787700,10485:16787701,10486:16787702,10487:16787703,10488:16787704,10489:16787705,10490:16787706,10491:16787707,10492:16787708,10493:16787709,10494:16787710,10495:16787711,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200};
return{fromUnicode:function(t){return e(n[t])},lookup:e}}(),Util={};Array.prototype.push8=function(e){this.push(255&e)},Array.prototype.push16=function(e){this.push(e>>8&255,255&e)},Array.prototype.push32=function(e){this.push(e>>24&255,e>>16&255,e>>8&255,255&e)},Array.prototype.map||(Array.prototype.map=function(e){var t=this.length;if("function"!=typeof e)throw new TypeError;for(var n=new Array(t),r=arguments[1],i=0;t>i;i++)i in this&&(n[i]=e.call(r,this[i],i,this));return n}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),Util._log_level="warn",Util.init_logging=function(e){switch("undefined"==typeof e?e=Util._log_level:Util._log_level=e,"undefined"==typeof window.console&&(window.console="undefined"!=typeof window.opera?{log:window.opera.postError,warn:window.opera.postError,error:window.opera.postError}:{log:function(){},warn:function(){},error:function(){}}),Util.Debug=Util.Info=Util.Warn=Util.Error=function(){},e){case"debug":Util.Debug=function(e){console.log(e)};case"info":Util.Info=function(e){console.log(e)};case"warn":Util.Warn=function(e){console.warn(e)};case"error":Util.Error=function(e){console.error(e)};case"none":break;default:throw"invalid logging type '"+e+"'"}},Util.get_logging=function(){return Util._log_level},Util.init_logging(),Util.conf_default=function(e,t,n,r,i,o,s,a){var l,u;l=function(t){return o in{arr:1,array:1}&&"undefined"!=typeof t?e[r][t]:e[r]},u=function(t,n){o in{"boolean":1,bool:1}?t=!t||t in{0:1,no:1,"false":1}?!1:!0:o in{integer:1,"int":1}?t=parseInt(t,10):"str"===o?t=String(t):"func"===o&&(t||(t=function(){})),"undefined"!=typeof n?e[r][n]=t:e[r]=t},t[r+"_description"]=a,"undefined"==typeof t["get_"+r]&&(t["get_"+r]=l),"undefined"==typeof t["set_"+r]&&(t["set_"+r]=function(t,n){if(i in{RO:1,ro:1})throw r+" is read-only";if(i in{WO:1,wo:1}&&"undefined"!=typeof e[r])throw r+" can only be set once";u(t,n)}),"undefined"!=typeof n[r]?s=n[r]:o in{arr:1,array:1}&&!(s instanceof Array)&&(s=[]),u(s)},Util.conf_defaults=function(e,t,n,r){var i;for(i=0;i<r.length;i++)Util.conf_default(e,t,n,r[i][0],r[i][1],r[i][2],r[i][3],r[i][4])},Util.decodeUTF8=function(e){return decodeURIComponent(escape(e))},Util.get_include_uri=function(){return"undefined"!=typeof INCLUDE_URI?INCLUDE_URI:"include/"},Util._loading_scripts=[],Util._pending_scripts=[],Util.load_scripts=function(e){for(var t,n=document.getElementsByTagName("head")[0],r=Util._loading_scripts,i=Util._pending_scripts,o=0;o<e.length;o++)t=document.createElement("script"),t.type="text/javascript",t.src=Util.get_include_uri()+e[o],t.onload=t.onreadystatechange=function(){for(;r.length>0&&("loaded"===r[0].readyState||"complete"===r[0].readyState);){var e=r.shift();n.appendChild(e)}(!this.readyState||Util.Engine.presto&&"loaded"===this.readyState||"complete"===this.readyState)&&i.indexOf(this)>=0&&(this.onload=this.onreadystatechange=null,i.splice(i.indexOf(this),1),0===i.length&&window.onscriptsload&&window.onscriptsload())},Util.Engine.trident?r.push(t):(t.async=!1,n.appendChild(t)),i.push(t)},Util.getPosition=function(){function e(e,t){if(e.currentStyle)var n=e.currentStyle[t];else if(window.getComputedStyle)var n=window.getComputedStyle(e,null)[t];return n}function t(){var e=0,t=0,n=document.getElementsByTagName("html")[0];return e=n.scrollTop&&document.documentElement.scrollTop?n.scrollTop:n.scrollTop||document.documentElement.scrollTop?n.scrollTop+document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0,t=n.scrollLeft&&document.documentElement.scrollLeft?n.scrollLeft:n.scrollLeft||document.documentElement.scrollLeft?n.scrollLeft+document.documentElement.scrollLeft:document.body.scrollLeft?document.body.scrollLeft:0,[t,e]}return function(n){for(var r=0,i=0,o=n,s=!1;(o=o.parentNode)&&o!=document.body;)r-=o.scrollLeft||0,i-=o.scrollTop||0,"fixed"==e(o,"position")&&(s=!0);if(s&&!window.opera){var a=t();r+=a[0],i+=a[1]}do r+=n.offsetLeft,i+=n.offsetTop;while(n=n.offsetParent);return{x:r,y:i}}}(),Util.getEventPosition=function(e,t,n){var r,i,o,s;r=e?e:window.event,r=r.changedTouches?r.changedTouches[0]:r.touches?r.touches[0]:r,r.pageX||r.pageY?(i=r.pageX,o=r.pageY):(r.clientX||r.clientY)&&(i=r.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=r.clientY+document.body.scrollTop+document.documentElement.scrollTop),s=Util.getPosition(t),"undefined"==typeof n&&(n=1);var a=i-s.x,l=o-s.y,u=Math.max(Math.min(a,t.width-1),0),c=Math.max(Math.min(l,t.height-1),0);return{x:u/n,y:c/n,realx:a/n,realy:l/n}},Util.addEvent=function(e,t,n){if(e.attachEvent){var r=e.attachEvent("on"+t,n);return r}if(e.addEventListener)return e.addEventListener(t,n,!1),!0;throw"Handler could not be attached"},Util.removeEvent=function(e,t,n){if(e.detachEvent){var r=e.detachEvent("on"+t,n);return r}if(e.removeEventListener)return e.removeEventListener(t,n,!1),!0;throw"Handler could not be removed"},Util.stopEvent=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1},Util.Features={xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector},Util.Engine={presto:function(){return window.opera?!0:!1}(),trident:function(){return window.ActiveXObject?window.XMLHttpRequest?document.querySelectorAll?6:5:4:!1}(),webkit:function(){try{return navigator.taintEnabled?!1:Util.Features.xpath?Util.Features.query?525:420:419}catch(e){return!1}}(),gecko:function(){return document.getBoxObjectFor||null!=window.mozInnerScreenX?document.getElementsByClassName?19:18:!1}()},Util.Engine.webkit&&(Util.Engine.webkit=function(e){var t=new RegExp("WebKit/([0-9.]*) ");return e=(navigator.userAgent.match(t)||["",e])[1],parseFloat(e,10)}(Util.Engine.webkit)),Util.Flash=function(){var e,t;try{e=navigator.plugins["Shockwave Flash"].description}catch(n){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(r){e="0 r0"}}return t=e.match(/\d+/g),{version:parseInt(t[0]||"0."+t[1],10)||0,build:parseInt(t[2],10)||0}}(),/*
 * Websock: high-performance binary WebSockets
 * Copyright (C) 2012 Joel Martin
 * Licensed under MPL 2.0 (see LICENSE.txt)
 *
 * Websock is similar to the standard WebSocket object but Websock
 * enables communication with raw TCP sockets (i.e. the binary stream)
 * via websockify. This is accomplished by base64 encoding the data
 * stream between Websock and websockify.
 *
 * Websock has built-in receive queue buffering; the message event
 * does not contain actual data but is simply a notification that
 * there is new data available. Several rQ* methods are available to
 * read binary data off of the receive queue.
 */
window.WebSocket&&!window.WEB_SOCKET_FORCE_FLASH?Websock_native=!0:window.MozWebSocket&&!window.WEB_SOCKET_FORCE_FLASH?(Websock_native=!0,window.WebSocket=window.MozWebSocket):(Websock_native=!1,function(){window.WEB_SOCKET_SWF_LOCATION=Util.get_include_uri()+"web-socket-js/WebSocketMain.swf",Util.Engine.trident&&(Util.Debug("Forcing uncached load of WebSocketMain.swf"),window.WEB_SOCKET_SWF_LOCATION+="?"+Math.random()),Util.load_scripts(["web-socket-js/swfobject.js","web-socket-js/web_socket.js"])}());var WebUtil={},$D;window.$D||(window.$D=function(e){return document.getElementById?document.getElementById(e):document.all?document.all[e]:document.layers?document.layers[e]:void 0}),WebUtil.init_logging=function(e){Util._log_level="undefined"!=typeof e?e:(document.location.href.match(/logging=([A-Za-z0-9\._\-]*)/)||["",Util._log_level])[1],Util.init_logging()},WebUtil.dirObj=function(e,t,n){var r,i="",o="";t||(t=2),n||(n="");for(r in e)t>1&&"object"==typeof e[r]?i+=WebUtil.dirObj(e[r],t-1,n+"."+r):(o="undefined"==typeof e[r]?"undefined":e[r].toString().replace("\n"," "),o.length>30&&(o=o.substr(0,30)+"..."),i+=n+"."+r+": "+o+"\n");return i},WebUtil.getQueryVar=function(e,t){var n=new RegExp(".*[?&]"+e+"=([^&#]*)"),r=document.location.href.match(n);return"undefined"==typeof t&&(t=null),r?decodeURIComponent(r[1]):t},WebUtil.createCookie=function(e,t,n){var r,i,o;n?(r=new Date,r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toGMTString()):i="",o="https:"===document.location.protocol?"; secure":"",document.cookie=e+"="+t+i+"; path=/"+o},WebUtil.readCookie=function(e,t){var n,r,i=e+"=",o=document.cookie.split(";");for(n=0;n<o.length;n+=1){for(r=o[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(i))return r.substring(i.length,r.length)}return"undefined"!=typeof t?t:null},WebUtil.eraseCookie=function(e){WebUtil.createCookie(e,"",-1)},WebUtil.initSettings=function(e){var t=Array.prototype.slice.call(arguments,1);window.chrome&&window.chrome.storage?window.chrome.storage.sync.get(function(n){WebUtil.settings=n,console.log(WebUtil.settings),e&&e.apply(this,t)}):e&&e.apply(this,t)},WebUtil.writeSetting=function(e,t){window.chrome&&window.chrome.storage?WebUtil.settings[e]!==t&&(WebUtil.settings[e]=t,window.chrome.storage.sync.set(WebUtil.settings)):localStorage.setItem(e,t)},WebUtil.readSetting=function(e,t){var n;return n=window.chrome&&window.chrome.storage?WebUtil.settings[e]:localStorage.getItem(e),"undefined"==typeof n&&(n=null),null===n&&void 0!==typeof t?t:n},WebUtil.eraseSetting=function(e){window.chrome&&window.chrome.storage?(window.chrome.storage.sync.remove(e),delete WebUtil.settings[e]):localStorage.removeItem(e)},WebUtil.getStylesheets=function(){var e,t,n=[];for(t=document.getElementsByTagName("link"),e=0;e<t.length;e+=1)t[e].title&&t[e].rel.toUpperCase().indexOf("STYLESHEET")>-1&&n.push(t[e]);return n},WebUtil.selectStylesheet=function(e){var t,n,r=WebUtil.getStylesheets();for("undefined"==typeof e&&(e="default"),t=0;t<r.length;t+=1)n=r[t],n.title===e?(Util.Debug("Using stylesheet "+e),n.disabled=!1):n.disabled=!0;return e};