function KeyEventDecoder(e,t){"use strict";function n(e){for(var n=0;n<e.length;++n)t(e[n])}function r(n,r){var i={type:r},o=kbdUtil.getKey(n);o&&(i.keyId=o);var s=kbdUtil.getKeysym(n),a=e.hasShortcutModifier()||!!e.activeCharModifier();s&&("keydown"!==r||kbdUtil.nonCharacterKey(n)||a)&&(i.keysym=s);var l=16===n.keyCode||"Shift"===n.key,u=!l&&("keydown"!==r||e.hasShortcutModifier()||!!kbdUtil.nonCharacterKey(n)),c="keydown"===r&&e.activeCharModifier()&&!kbdUtil.nonCharacterKey(n),d=e.activeCharModifier();if(d&&s){for(var f=!1,h=0;h<d.length;++h)d[h]===s.keysym&&(f=!0);"keypress"!==r||f||(i.escape=e.activeCharModifier())}return c&&t({type:"stall"}),t(i),u}return{keydown:function(t){return n(e.keydown(t)),r(t,"keydown")},keypress:function(e){return r(e,"keypress")},keyup:function(t){return n(e.keyup(t)),r(t,"keyup")},syncModifiers:function(t){n(e.syncAny(t))},releaseAll:function(){t({type:"releaseall"})}}}function VerifyCharModifier(e){"use strict";function t(){if(!r)for(;0!==n.length;){var i=n[0];switch(n=n.splice(1),i.type){case"stall":return void(r=setTimeout(function(){clearTimeout(r),r=null,t()},5));case"keydown":0!==n.length&&"keypress"===n[0].type&&(!n[0].escape||i.keysym&&i.keysym.keysym===n[0].keysym.keysym||(i.escape=n[0].escape),i.keysym=n[0].keysym,n=n.splice(1))}"stall"!==i.type&&e(i)}}var n=[],r=null;return function(e){n.push(e),t()}}function TrackKeyState(e){"use strict";var t=[];return function(n){var r=0!==t.length?t[t.length-1]:null;switch(n.type){case"keydown":r&&n.keyId&&r.keyId===n.keyId||(r={keyId:n.keyId,keysyms:{}},t.push(r)),n.keysym&&(r.keysyms[n.keysym.keysym]=n.keysym,r.ignoreKeyPress=!0,e(n));break;case"keypress":r||(r={keyId:n.keyId,keysyms:{}},t.push(r)),n.keysym||console.log("keypress with no keysym:",n),n.keysym&&!r.ignoreKeyPress&&(r.keysyms[n.keysym.keysym]=n.keysym,n.type="keydown",e(n));break;case"keyup":if(0===t.length)return;for(var i=null,o=0;o!==t.length;++o)if(t[o].keyId===n.keyId){i=o;break}null===i&&(i=t.length-1);var s=t.splice(i,1)[0];for(var a in s.keysyms){var l=function(){function e(){}return function(t){return e.prototype=t,new e}}(),u=l(n);u.keysym=s.keysyms[a],e(u)}break;case"releaseall":for(var o=0;o<t.length;++o)for(var a in t[o].keysyms){var c=t[o].keysyms[a];e({keyId:0,keysym:c,type:"keyup"})}t=[]}}}function EscapeModifiers(e){"use strict";return function(t){if("keydown"!==t.type||void 0===t.escape)return void e(t);for(var n=0;n<t.escape.length;++n)e({type:"keyup",keyId:0,keysym:keysyms.lookup(t.escape[n])});e(t);for(var n=0;n<t.escape.length;++n)e({type:"keydown",keyId:0,keysym:keysyms.lookup(t.escape[n])})}}var kbdUtil=function(){"use strict";function e(e){var t={536:350,537:351,538:354,539:355},n=t[e];return n?n:e}function t(){return navigator&&!!/mac/i.exec(navigator.platform)}function n(){return navigator&&!!/win/i.exec(navigator.platform)}function r(){return navigator&&!!/linux/i.exec(navigator.platform)}function i(e,t){var n={};for(var r in t)65505!==parseInt(r)&&(n[r]=t[r]);var i=0;for(var s in t)n[s]&&++i;return o(e,n)?i>e.length:i>0}function o(e,t){if(0===e.length)return!1;for(var n=0;n<e.length;++n)if(!t[e[n]])return!1;return!0}function s(e){function s(e,t){function n(e){return{keysym:keysyms.lookup(e),type:p[e]?"keydown":"keyup"}}var r=[];return void 0!==e.ctrlKey&&e.ctrlKey!==p[u]&&t!==u&&(p[u]=e.ctrlKey,r.push(n(u))),void 0!==e.altKey&&e.altKey!==p[c]&&t!==c&&(p[c]=e.altKey,r.push(n(c))),void 0!==e.altGraphKey&&e.altGraphKey!==p[d]&&t!==d&&(p[d]=e.altGraphKey,r.push(n(d))),void 0!==e.shiftKey&&e.shiftKey!==p[f]&&t!==f&&(p[f]=e.shiftKey,r.push(n(f))),void 0!==e.metaKey&&e.metaKey!==p[h]&&t!==h&&(p[h]=e.metaKey,r.push(n(h))),r}function a(e,t){var n=l(e),r=n?n.keysym:null;return null!==r&&void 0!==p[r]&&(p[r]=t),s(e,r)}var u=65507,c=65513,d=65027,f=65505,h=65511;e||(e=t()?[c]:n()?[c,u]:r()?[d]:[]);var p={};return p[u]=!1,p[c]=!1,p[d]=!1,p[f]=!1,p[h]=!1,{keydown:function(e){return a(e,!0)},keyup:function(e){return a(e,!1)},syncAny:function(e){return s(e)},hasShortcutModifier:function(){return i(e,p)},activeCharModifier:function(){return o(e,p)?e:null}}}function a(e){return"keyCode"in e&&"key"in e?e.key+":"+e.keyCode:"keyCode"in e?e.keyCode:e.key}function l(t){var n;if(t.char&&1===t.char.length?n=t.char.charCodeAt():t.charCode?n=t.charCode:t.keyCode&&"keypress"===t.type&&(n=t.keyCode),n){var r=keysyms.fromUnicode(e(n));if(r)return r}return t.keyCode?keysyms.lookup(u(t.keyCode,t.shiftKey)):t.which?keysyms.lookup(u(t.which,t.shiftKey)):null}function u(e,t){if("number"!=typeof e)return null;if(e>=48&&57>=e)return e;if(e>=65&&90>=e)return t?e:e+32;if(e>=96&&105>=e)return 65456+(e-96);switch(e){case 32:return 32;case 106:return 65450;case 107:return 65451;case 108:return 65452;case 109:return 65453;case 110:return 65454;case 111:return 65455;case 187:return 43;case 188:return 44;case 189:return 45;case 190:return 46}return c({keyCode:e})}function c(e){if(!e.keyCode)return null;var t=e.keyCode;if(t>=112&&135>=t)return 65470+t-112;switch(t){case 8:return 65288;case 13:return 65293;case 9:return 65289;case 27:return 65307;case 46:return 65535;case 36:return 65360;case 35:return 65367;case 33:return 65365;case 34:return 65366;case 45:return 65379;case 37:return 65361;case 38:return 65362;case 39:return 65363;case 40:return 65364;case 16:return 65505;case 17:return 65507;case 18:return 65513;case 224:return 65031;case 225:return 65027;case 91:return 65516;case 92:return 65517;case 93:return 65383;default:return null}}return{hasShortcutModifier:i,hasCharModifier:o,ModifierSync:s,getKey:a,getKeysym:l,keysymFromKeyCode:u,nonCharacterKey:c,substituteCodepoint:e}}();